=== RUN   TestEncodeBlockAnnounce
=== PAUSE TestEncodeBlockAnnounce
=== RUN   TestDecodeBlockAnnounce
=== PAUSE TestDecodeBlockAnnounce
=== RUN   TestEncodeBlockAnnounceHandshake
=== PAUSE TestEncodeBlockAnnounceHandshake
=== RUN   TestDecodeBlockAnnounceHandshake
=== PAUSE TestDecodeBlockAnnounceHandshake
=== RUN   TestHandleBlockAnnounceMessage
=== PAUSE TestHandleBlockAnnounceMessage
=== RUN   TestValidateBlockAnnounceHandshake
=== PAUSE TestValidateBlockAnnounceHandshake
=== RUN   TestBuildIdentity
=== PAUSE TestBuildIdentity
=== RUN   TestBuild
=== PAUSE TestBuild
=== RUN   TestMinPeers
=== PAUSE TestMinPeers
=== RUN   TestMaxPeers
=== PAUSE TestMaxPeers
=== RUN   TestProtectUnprotectPeer
=== PAUSE TestProtectUnprotectPeer
=== RUN   TestPersistentPeers
=== PAUSE TestPersistentPeers
=== RUN   TestRemovePeer
=== PAUSE TestRemovePeer
=== RUN   TestSetReservedPeer
=== PAUSE TestSetReservedPeer
=== RUN   TestKadDHT
=== PAUSE TestKadDHT
=== RUN   TestBeginDiscovery
=== PAUSE TestBeginDiscovery
=== RUN   TestBeginDiscovery_ThreeNodes
=== PAUSE TestBeginDiscovery_ThreeNodes
=== RUN   TestGossip
=== PAUSE TestGossip
=== RUN   TestExternalAddrs
=== PAUSE TestExternalAddrs
=== RUN   TestExternalAddrsPublicIP
=== PAUSE TestExternalAddrsPublicIP
=== RUN   TestConnect
=== PAUSE TestConnect
=== RUN   TestBootstrap
=== PAUSE TestBootstrap
=== RUN   TestSend
=== PAUSE TestSend
=== RUN   TestExistingStream
=== PAUSE TestExistingStream
=== RUN   TestStreamCloseMetadataCleanup
=== PAUSE TestStreamCloseMetadataCleanup
=== RUN   Test_PeerSupportsProtocol
=== PAUSE Test_PeerSupportsProtocol
=== RUN   Test_AddReservedPeers
=== PAUSE Test_AddReservedPeers
=== RUN   Test_RemoveReservedPeers
=== PAUSE Test_RemoveReservedPeers
=== RUN   TestStreamCloseEOF
=== PAUSE TestStreamCloseEOF
=== RUN   TestPeerConnect
=== PAUSE TestPeerConnect
=== RUN   TestBannedPeer
=== PAUSE TestBannedPeer
=== RUN   TestPeerReputation
=== PAUSE TestPeerReputation
=== RUN   TestEncodeLightRequest
=== PAUSE TestEncodeLightRequest
=== RUN   TestEncodeLightResponse
=== PAUSE TestEncodeLightResponse
=== RUN   TestDecodeLightMessage
=== PAUSE TestDecodeLightMessage
=== RUN   TestHandleLightMessage_Response
=== PAUSE TestHandleLightMessage_Response
=== RUN   TestMDNS
=== PAUSE TestMDNS
=== RUN   TestMessageCache
=== PAUSE TestMessageCache
=== RUN   TestMessageCacheError
=== PAUSE TestMessageCacheError
=== RUN   TestEncodeBlockRequestMessage
=== PAUSE TestEncodeBlockRequestMessage
=== RUN   TestEncodeBlockRequestMessage_BlockHash
=== PAUSE TestEncodeBlockRequestMessage_BlockHash
=== RUN   TestEncodeBlockRequestMessage_BlockNumber
=== PAUSE TestEncodeBlockRequestMessage_BlockNumber
=== RUN   TestBlockRequestString
=== PAUSE TestBlockRequestString
=== RUN   TestEncodeBlockRequestMessage_NoOptionals
=== PAUSE TestEncodeBlockRequestMessage_NoOptionals
=== RUN   TestEncodeBlockResponseMessage_Empty
=== PAUSE TestEncodeBlockResponseMessage_Empty
=== RUN   TestEncodeBlockResponseMessage_WithBody
=== PAUSE TestEncodeBlockResponseMessage_WithBody
=== RUN   TestEncodeBlockResponseMessage_WithAll
=== PAUSE TestEncodeBlockResponseMessage_WithAll
=== RUN   TestEncodeBlockAnnounceMessage
=== PAUSE TestEncodeBlockAnnounceMessage
=== RUN   TestDecode_BlockAnnounceMessage
=== PAUSE TestDecode_BlockAnnounceMessage
=== RUN   TestEncodeTransactionMessageSingleExtrinsic
=== PAUSE TestEncodeTransactionMessageSingleExtrinsic
=== RUN   TestEncodeTransactionMessageTwoExtrinsics
=== PAUSE TestEncodeTransactionMessageTwoExtrinsics
=== RUN   TestDecodeTransactionMessageOneExtrinsic
=== PAUSE TestDecodeTransactionMessageOneExtrinsic
=== RUN   TestDecodeTransactionMessageTwoExtrinsics
=== PAUSE TestDecodeTransactionMessageTwoExtrinsics
=== RUN   TestDecodeConsensusMessage
=== PAUSE TestDecodeConsensusMessage
=== RUN   TestCreateDecoder_BlockAnnounce
=== PAUSE TestCreateDecoder_BlockAnnounce
=== RUN   TestCreateNotificationsMessageHandler_BlockAnnounce
=== PAUSE TestCreateNotificationsMessageHandler_BlockAnnounce
=== RUN   TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
=== PAUSE TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
=== RUN   Test_HandshakeTimeout
=== PAUSE Test_HandshakeTimeout
=== RUN   TestCreateNotificationsMessageHandler_HandleTransaction
=== PAUSE TestCreateNotificationsMessageHandler_HandleTransaction
=== RUN   TestBlockAnnounceHandshakeSize
=== PAUSE TestBlockAnnounceHandshakeSize
=== RUN   Test_sizedBufferPool
=== PAUSE Test_sizedBufferPool
=== RUN   Test_sizedBufferPool_race
=== PAUSE Test_sizedBufferPool_race
=== RUN   TestStartService
=== PAUSE TestStartService
=== RUN   TestBroadcastMessages
=== PAUSE TestBroadcastMessages
=== RUN   TestBroadcastDuplicateMessage
=== PAUSE TestBroadcastDuplicateMessage
=== RUN   TestService_NodeRoles
=== PAUSE TestService_NodeRoles
=== RUN   TestService_Health
=== PAUSE TestService_Health
=== RUN   TestPersistPeerStore
=== PAUSE TestPersistPeerStore
=== RUN   TestHandleConn
=== PAUSE TestHandleConn
=== RUN   TestSerivceIsMajorSyncMetrics
=== PAUSE TestSerivceIsMajorSyncMetrics
=== RUN   TestStreamManager
=== PAUSE TestStreamManager
=== RUN   TestStreamManager_KeepStream
    stream_manager_test.go:91: 
--- SKIP: TestStreamManager_KeepStream (0.00s)
=== RUN   TestDecodeSyncMessage
=== PAUSE TestDecodeSyncMessage
=== RUN   TestDecodeTransactionHandshake
=== PAUSE TestDecodeTransactionHandshake
=== RUN   TestHandleTransactionMessage
=== PAUSE TestHandleTransactionMessage
=== RUN   TestStringToAddrInfo
--- PASS: TestStringToAddrInfo (0.00s)
=== RUN   TestStringsToAddrInfos
--- PASS: TestStringsToAddrInfos (0.00s)
=== RUN   TestGenerateKey
--- PASS: TestGenerateKey (0.01s)
=== RUN   TestReadLEB128ToUint64
--- PASS: TestReadLEB128ToUint64 (0.00s)
=== RUN   TestInvalidLeb128
--- PASS: TestInvalidLeb128 (0.00s)
=== CONT  TestEncodeBlockAnnounce
=== CONT  TestConnect
=== CONT  TestSend
=== CONT  TestEncodeBlockRequestMessage_BlockHash
=== CONT  TestProtectUnprotectPeer
=== CONT  TestDecodeTransactionHandshake
=== CONT  TestExternalAddrsPublicIP
--- PASS: TestDecodeTransactionHandshake (0.00s)
--- PASS: TestProtectUnprotectPeer (0.00s)
=== CONT  TestDecodeSyncMessage
=== CONT  TestStreamManager
=== CONT  TestHandleTransactionMessage
--- PASS: TestEncodeBlockAnnounce (0.00s)
=== CONT  TestHandleConn
--- PASS: TestEncodeBlockRequestMessage_BlockHash (0.00s)
=== CONT  TestSerivceIsMajorSyncMetrics
--- PASS: TestDecodeSyncMessage (0.00s)
=== CONT  TestService_Health
=== CONT  TestPersistPeerStore
--- PASS: TestSerivceIsMajorSyncMetrics (0.00s)
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleConn4268313620/001/TestHandleConn/nodeA/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSend2900299396/001/TestSend/nodeA/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistPeerStore94951440/001/TestPersistPeerStore/node0/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleTransactionMessage3641071078/001/TestHandleTransactionMessage/nodeA/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestConnect3616675384/001/TestConnect/nodeA/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExternalAddrsPublicIP1770149508/001/TestExternalAddrsPublicIP/node/node.key	pkg=network
2021-12-07T14:13:18-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestService_Health1709777133/001/TestService_Health/nodeA/node.key	pkg=network
2021-12-07T14:13:18-04:00 DBUG using config PublicIP: 10.0.5.2	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59917/p2p/12D3KooWDGM8pN1FEoxTS6J6vcuVwuqJodNmTpts4kWomenuSBds	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59920/p2p/12D3KooWJpgKwogrp1u5FfWkM4nNLfY7vBrDSKs4ewPt5oDNQAu1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59918/p2p/12D3KooWAnSQbPBMtjW7mzqW3e4ws5Ar37MYnHd5wmcx3bFRWFwk	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59919/p2p/12D3KooWR8sskw9WBDGAKh8imiZTfJp43hyFiKbcTa2WpPwEWee1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59922/p2p/12D3KooWAaEtWJG25WygAaXGCQF9ECpQM9shnFgUj9hgChquSwxi	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59923/p2p/12D3KooWMrGBjUfQ7iVsrHvpUyCCmNbZEqTnugnEtsXCnimZ7KHS	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/10.0.5.2/tcp/59923/p2p/12D3KooWMrGBjUfQ7iVsrHvpUyCCmNbZEqTnugnEtsXCnimZ7KHS	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:18-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:18-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59921/p2p/12D3KooWBMEB5PmjCD5GKbG4biU3tpDnNZ4hNGHYdHVMcN1d2vco	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistPeerStore94951440/002/TestPersistPeerStore/node1/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSend2900299396/002/TestSend/nodeB/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestConnect3616675384/002/TestConnect/nodeB/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleConn4268313620/002/TestHandleConn/nodeB/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59925/p2p/12D3KooWSSWfJkQPLRbvm1YsgMB6mUhwpW2H9jFvTvtWBvfsD7u6	pkg=network
=== CONT  TestService_NodeRoles
--- PASS: TestExternalAddrsPublicIP (1.24s)
=== CONT  TestBroadcastDuplicateMessage
--- PASS: TestHandleTransactionMessage (1.25s)
--- PASS: TestService_Health (1.27s)
=== CONT  TestBroadcastMessages
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestService_NodeRoles2602836300/001/TestService_NodeRoles/node/node.key	pkg=network
2021-12-07T14:13:19-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastDuplicateMessage1298061595/001/TestBroadcastDuplicateMessage/nodeA/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59926/p2p/12D3KooWJ4yNtwAFyY9JVw3gLDFdhRmBhbiW7cTHaAzBjk126gex	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastMessages80421202/001/TestBroadcastMessages/nodeA/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59927/p2p/12D3KooWNSXEVi6n8F5mrigpPNHtPrXxyuAdLv4MKFUCwzTz1fNF	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59928/p2p/12D3KooWGrnKabWEhfJ82BdUjHtuCYEHm2Rek6xTwYLKkGLAV2iV	pkg=network
=== CONT  TestService_NodeRoles
    service_test.go:266: 
        	Error Trace:	service_test.go:102
        	            				service_test.go:266
        	Error:      	Received unexpected error:
        	            	failed to listen on any addresses: [listen tcp4 0.0.0.0:7000: bind: address already in use]
        	Test:       	TestService_NodeRoles
--- FAIL: TestService_NodeRoles (0.29s)
=== CONT  TestStartService
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59929/p2p/12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc	pkg=network
2021-12-07T14:13:19-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStartService1037822963/001/TestStartService/node/node.key	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:19-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:19-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59930/p2p/12D3KooWNTj2Sx1REpoLn4MPAvUFuShPwGABZ8DUxEFy9XFgtM8c	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59931/p2p/12D3KooWL5hwT1F24bmp6ny3e43vvi2MUGNDbEu9hLBJhtMTEonL	pkg=network
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
==================
WARNING: DATA RACE
Write at 0x00c000756118 by goroutine 90:
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:87 +0x557
  github.com/ChainSafe/gossamer/dot/network.TestPersistPeerStore()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:319 +0x43e
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c000756118 by goroutine 308:
  github.com/ChainSafe/gossamer/dot/network.(*Service).startTxnBatchProcessing()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/transaction.go:123 +0x26a
  github.com/ChainSafe/gossamer/dot/network.(*Service).createBatchMessageHandler·dwrap·25()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/transaction.go:150 +0x47

Goroutine 90 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59917/p2p/12D3KooWDGM8pN1FEoxTS6J6vcuVwuqJodNmTpts4kWomenuSBds	pkg=network
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastMessages80421202/002/TestBroadcastMessages/nodeB/node.key	pkg=network
2021-12-07T14:13:20-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastDuplicateMessage1298061595/002/TestBroadcastDuplicateMessage/nodeB/node.key	pkg=network
=== CONT  TestConnect
    testing.go:1152: race detected during execution of test
--- FAIL: TestConnect (2.13s)
=== CONT  Test_sizedBufferPool_race
=== CONT  Test_sizedBufferPool
--- PASS: Test_sizedBufferPool_race (0.00s)
=== CONT  TestCreateNotificationsMessageHandler_HandleTransaction
--- PASS: Test_sizedBufferPool (0.00s)
2021-12-07T14:13:20.515-0400	ERROR	peerstore/ds	pstoreds/keybook.go:65	error when fetching pubkey from datastore for peer 12D3KooWAaEtWJG25WygAaXGCQF9ECpQM9shnFgUj9hgChquSwxi: datastore closed

2021-12-07T14:13:20.518-0400	ERROR	peerstore/ds	pstoreds/keybook.go:85	error while updating pubkey in datastore for peer 12D3KooWAaEtWJG25WygAaXGCQF9ECpQM9shnFgUj9hgChquSwxi: datastore closed

2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_HandleTransaction3714922272/001/TestCreateNotificationsMessageHandler_HandleTransaction/nodeA/node.key	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59932/p2p/12D3KooWPTRWGoqdT7QLFLBVcBjYjeSoiCXeS3vAzRiWhv7XpoB8	pkg=network
=== CONT  TestStartService
    testing.go:1152: race detected during execution of test
--- FAIL: TestStartService (0.90s)
=== CONT  TestBlockAnnounceHandshakeSize
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
--- PASS: TestBlockAnnounceHandshakeSize (0.00s)
=== CONT  TestHandleConn
    testing.go:1152: race detected during execution of test
=== CONT  Test_HandshakeTimeout
--- FAIL: TestHandleConn (2.44s)
2021-12-07T14:13:20-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_HandshakeTimeout1742717102/001/Test_HandshakeTimeout/nodeA/node.key	pkg=network
2021-12-07T14:13:20-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake540250484/001/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake/nodeA/node.key	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59933/p2p/12D3KooWDk9g6Attx6BpQ9HFyqHtUG365z1SFDo5x52hWvVNK6We	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:20-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:20-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59934/p2p/12D3KooWLjYAwxJRnbiVMDkZzWD5X7SpZ3YWLk4rJDPMnTVr5yJY	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59935/p2p/12D3KooWSfRwGZEi2Xt53YZ7t4hisQrbKtQ1zzbfZcZUxnXB4CW7	pkg=network
=== CONT  TestPersistPeerStore
    testing.go:1152: race detected during execution of test
=== CONT  TestCreateDecoder_BlockAnnounce
--- FAIL: TestPersistPeerStore (2.77s)
==================
WARNING: DATA RACE
Write at 0x000005df4ec8 by goroutine 93:
  github.com/ChainSafe/gossamer/dot/network.setupStreamManagerTest.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/stream_manager_test.go:28 +0x32
  testing.(*common).Cleanup.func1()
      /usr/local/go/src/testing/testing.go:912 +0x199
  testing.(*common).runCleanup()
      /usr/local/go/src/testing/testing.go:1049 +0x154
  testing.tRunner.func2()
      /usr/local/go/src/testing/testing.go:1253 +0x4f
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1265 +0x268
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x000005df4ec8 by goroutine 271:
  github.com/ChainSafe/gossamer/dot/network.(*streamManager).start.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/stream_manager.go:39 +0x4a

Goroutine 93 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
=== CONT  TestStreamManager
    testing.go:1152: race detected during execution of test
--- FAIL: TestStreamManager (2.77s)
=== CONT  TestDecodeConsensusMessage
--- PASS: TestDecodeConsensusMessage (0.00s)
=== CONT  TestDecodeTransactionMessageTwoExtrinsics
--- PASS: TestDecodeTransactionMessageTwoExtrinsics (0.00s)
=== CONT  TestDecodeTransactionMessageOneExtrinsic
--- PASS: TestDecodeTransactionMessageOneExtrinsic (0.00s)
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounce
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateDecoder_BlockAnnounce3588465220/001/TestCreateDecoder_BlockAnnounce/nodeA/node.key	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounce1836464503/001/TestCreateNotificationsMessageHandler_BlockAnnounce/nodeA/node.key	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59936/p2p/12D3KooWGLxDrmGxuJjiFRVaBdbR4hE2xoAtfq2x6M9yycm9MXwm	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c020ab8450 by goroutine 45:
  runtime.mapaccess2_faststr()
      /usr/local/go/src/runtime/map_faststr.go:107 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:209 +0xa3c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c020ab8450 by goroutine 154:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c000303108 by goroutine 45:
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:209 +0xa4d
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network

Previous write at 0x00c000303108 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00073aeb0 by goroutine 45:
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xae4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00073aeb0 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x17c
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c01a928ea0 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a928ea0 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:194 +0x77b
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c01a928ea8 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1425 +0x1d8
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a928ea8 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:195 +0x7c8
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c01a928eb8 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1419 +0x225
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a928eb8 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:196 +0x835
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c000f1f7e0 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:90 +0x1684
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c000f1f7e0 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:182 +0x6fa
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c01a928ec0 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a928ec0 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:197 +0x89a
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c01a928ec8 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1419 +0x225
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a928ec8 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:198 +0x8ba
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00a6eb2bc by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00a6eb2b8 by goroutine 154:
  github.com/ChainSafe/gossamer/dot/network/proto.(*BlockRequest).Reset()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/proto/api.v1.pb.go:102 +0x37
  google.golang.org/protobuf/proto.Reset()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/reset.go:18 +0x4d
  google.golang.org/protobuf/proto.UnmarshalOptions.unmarshal()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/decode.go:77 +0xcc
  google.golang.org/protobuf/proto.Unmarshal()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/decode.go:50 +0xa4
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:152 +0xf4
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 154 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:13:21-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59937/p2p/12D3KooWPy85jMzfphuTT8iNNMfY9Njf7G6vvVXY6tnTEZNTXFPu	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59938/p2p/12D3KooWNqGaMQBBWQqCEUmvFqFuqahWuQtNQoz2xc3sS2XyxA6T	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWNTj2Sx1REpoLn4MPAvUFuShPwGABZ8DUxEFy9XFgtM8c message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_HandleTransaction3714922272/002/TestCreateNotificationsMessageHandler_HandleTransaction/nodeB/node.key	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
=== CONT  TestSend
    testing.go:1152: race detected during execution of test
--- FAIL: TestSend (3.16s)
=== CONT  TestEncodeTransactionMessageTwoExtrinsics
=== CONT  TestDecode_BlockAnnounceMessage
--- PASS: TestEncodeTransactionMessageTwoExtrinsics (0.00s)
--- PASS: TestDecode_BlockAnnounceMessage (0.00s)
=== CONT  TestEncodeTransactionMessageSingleExtrinsic
=== CONT  TestEncodeBlockAnnounceMessage
--- PASS: TestEncodeTransactionMessageSingleExtrinsic (0.00s)
=== CONT  TestEncodeBlockResponseMessage_WithAll
--- PASS: TestEncodeBlockAnnounceMessage (0.00s)
=== CONT  TestEncodeBlockResponseMessage_Empty
--- PASS: TestEncodeBlockResponseMessage_WithAll (0.01s)
=== CONT  TestEncodeBlockResponseMessage_WithBody
--- PASS: TestEncodeBlockResponseMessage_Empty (0.00s)
=== CONT  TestBlockRequestString
--- PASS: TestEncodeBlockResponseMessage_WithBody (0.00s)
BlockRequestMessage RequestedData=1 StartingBlock={[220 209 52 103 1 202 131 150 73 110 82 170 39 133 177 116 141 235 109 176 149 81 183 33 89 220 179 224 137 145 2 91]} EndBlockHash=0x0000000000000000000000000000000000000000000000000000000000000000 Direction=1 Max=0
=== CONT  TestEncodeBlockRequestMessage_BlockNumber
--- PASS: TestBlockRequestString (0.00s)
=== CONT  TestBuild
--- PASS: TestEncodeBlockRequestMessage_BlockNumber (0.00s)
=== CONT  TestMaxPeers
--- PASS: TestBuild (0.01s)
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59939/p2p/12D3KooWMEysNai47o9tryde9ERc3rF9a1aXGCvTE2Dnoq674WG5	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers3105340035/001/TestMaxPeers/node0/node.key	pkg=network
2021-12-07T14:13:21-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake540250484/002/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake/nodeB/node.key	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59940/p2p/12D3KooWCHZMTgNBkfV6wW1grQymbCuyfqPBpsMZTLFLH3BxLZYq	pkg=network
==================
WARNING: DATA RACE
Write at 0x00c017b8c258 by goroutine 87:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:248 +0xe8b
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c017b8c258 by goroutine 212:
  github.com/ChainSafe/gossamer/dot/network.(*Service).sendData()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:285 +0x3b2
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding·dwrap·10()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0xb4

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 2 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_HandshakeTimeout1742717102/002/Test_HandshakeTimeout/nodeB/node.key	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:13:21-04:00 DBUG gossiping from host 12D3KooWRNdRRVkLSERpAk34FpTzsfzx8kYMiQqByMerVEG5v7Tc message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c00fdca900 by goroutine 87:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:255 +0xf78
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00fdca900 by goroutine 657:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 657 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00fdf28c8 by goroutine 87:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:255 +0xf85
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00fdf28c8 by goroutine 657:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 657 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:13:21-04:00 DBUG failed to read from stream using protocol /gossamer/test/0/block-announces/1: failed to read length: stream reset	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59941/p2p/12D3KooWDScHiMwhSGsBRLZqURT4gTxt7rPwxKiE9ExX567hu1oN	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:21-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59942/p2p/12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA	pkg=network
2021-12-07T14:13:21-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:21-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounce1836464503/002/TestCreateNotificationsMessageHandler_BlockAnnounce/nodeB/node.key	pkg=network
==================
WARNING: DATA RACE
Write at 0x00c000d370f0 by goroutine 87:
  runtime.closechan()
      /usr/local/go/src/runtime/chan.go:355 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:144 +0x7e
  github.com/ChainSafe/gossamer/dot/network.(*Service).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:456 +0x223
  github.com/ChainSafe/gossamer/dot/network.createTestService.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:110 +0x4a
  testing.(*common).Cleanup.func1()
      /usr/local/go/src/testing/testing.go:912 +0x199
  testing.(*common).runCleanup()
      /usr/local/go/src/testing/testing.go:1049 +0x154
  testing.tRunner.func2()
      /usr/local/go/src/testing/testing.go:1253 +0x4f
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1265 +0x268
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c000d370f0 by goroutine 90:
  runtime.chansend()
      /usr/local/go/src/runtime/chan.go:158 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).ReportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:77 +0xf0
  github.com/ChainSafe/gossamer/dot/network.(*Service).sendData()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:315 +0x957
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding·dwrap·10()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0xb4

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
=== CONT  TestCreateDecoder_BlockAnnounce
    testing.go:1152: race detected during execution of test
=== CONT  TestBroadcastDuplicateMessage
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateDecoder_BlockAnnounce (0.90s)
--- FAIL: TestBroadcastDuplicateMessage (2.42s)
=== CONT  TestBeginDiscovery_ThreeNodes
=== CONT  TestMinPeers
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes357404136/001/TestBeginDiscovery_ThreeNodes/nodeA/node.key	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers2143916590/001/TestMinPeers/node0/node.key	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59943/p2p/12D3KooWKNe2WVKYHTWr5AGjYjqFBsd21CSXnUKejNujoC8yWhv5	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers3105340035/002/TestMaxPeers/node1/node.key	pkg=network
2021-12-07T14:13:22-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59946/p2p/12D3KooWLw39ALuGNgEcb8KTyLJzBVuERrw14hDnuhpcQYG4rzGy	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59945/p2p/12D3KooWGS94dWHgoBP255gJjsLJeMF2zs4DEyQBGxVwzDfESANJ	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59947/p2p/12D3KooWSDSVuRRX8kkfLmjKHUsdxYfaC7gV3tyTXFWFSLpDHgdp	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 DBUG transaction message TransactionMessage extrinsics count=2 for peer 12D3KooWMEysNai47o9tryde9ERc3rF9a1aXGCvTE2Dnoq674WG5 not included into batch	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWSfRwGZEi2Xt53YZ7t4hisQrbKtQ1zzbfZcZUxnXB4CW7	pkg=network
2021-12-07T14:13:22-04:00 DBUG gossiping from host 12D3KooWGLxDrmGxuJjiFRVaBdbR4hE2xoAtfq2x6M9yycm9MXwm message of type 0: BlockAnnounceHandshake Roles=4 BestBlockNumber=77 BestBlockHash=0x0100000000000000000000000000000000000000000000000000000000000000 GenesisHash=0x0200000000000000000000000000000000000000000000000000000000000000	pkg=network
2021-12-07T14:13:22-04:00 EROR message type 0 not supported by any notifications protocol	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
    testing.go:1152: race detected during execution of test
=== CONT  TestBuildIdentity
--- FAIL: TestCreateNotificationsMessageHandler_BlockAnnounceHandshake (1.77s)
--- PASS: TestBuildIdentity (0.00s)
=== CONT  TestEncodeBlockAnnounceHandshake
=== CONT  TestHandleBlockAnnounceMessage
--- PASS: TestEncodeBlockAnnounceHandshake (0.00s)
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleBlockAnnounceMessage2286750253/001/TestHandleBlockAnnounceMessage/nodeA/node.key	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:22-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59948/p2p/12D3KooWHQ7NpL25BTEibxBpbCtcaCy6pz5Uhgi2UXB1MXSuKstC	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers2143916590/002/TestMinPeers/node1/node.key	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes357404136/002/TestBeginDiscovery_ThreeNodes/nodeB/node.key	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounce
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateNotificationsMessageHandler_BlockAnnounce (1.70s)
=== CONT  TestValidateBlockAnnounceHandshake
2021-12-07T14:13:22-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestValidateBlockAnnounceHandshake1812365492/001/TestValidateBlockAnnounceHandshake/nodeA/node.key	pkg=network
2021-12-07T14:13:22-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers3105340035/003/TestMaxPeers/node2/node.key	pkg=network
2021-12-07T14:13:22-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59949/p2p/12D3KooWPJBfyy3NJiy3ivLB6YSJoyoa9qje9iDhCo13sHCVEAL6	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59950/p2p/12D3KooWJaqt85p8SvStq5Yw37BmHxLwmNLht9pursKd79PKUowv	pkg=network
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59951/p2p/12D3KooWLXadDjmWGsB1FKX6FtELBJb6DU8dgkYRqZyaJ4wpZMaY	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59952/p2p/12D3KooWCQvHti48robsw8ciKfUdX9P1fqCSCWFN6aFoqtaXzMiS	pkg=network
=== CONT  TestBannedPeer
--- PASS: TestHandleBlockAnnounceMessage (0.69s)
2021-12-07T14:13:23-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBannedPeer1916623432/001/TestBannedPeer/nodeA/node.key	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59953/p2p/12D3KooWEoz1dpy9pCdRBJ1jJ2U89GGHpLGGWeXGMrWTZLANvij5	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c01a8f8ed0 by goroutine 86:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastMessages()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:181 +0x9a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01a8f8ed0 by goroutine 215:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 86 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 215 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00a622b88 by goroutine 86:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastMessages()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:181 +0x9b1
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00a622b88 by goroutine 215:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 86 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 215 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:13:23-04:00 DBUG failed to read from stream using protocol /gossamer/test/0/block-announces/1: failed to read length: stream reset	pkg=network
=== CONT  TestBroadcastMessages
    testing.go:1152: race detected during execution of test
=== CONT  TestEncodeBlockRequestMessage_NoOptionals
--- FAIL: TestBroadcastMessages (3.89s)
=== CONT  TestEncodeBlockRequestMessage
--- PASS: TestEncodeBlockRequestMessage_NoOptionals (0.00s)
=== CONT  TestMessageCache
--- PASS: TestEncodeBlockRequestMessage (0.00s)
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers2143916590/003/TestMinPeers/nodeB/node.key	pkg=network
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers3105340035/004/TestMaxPeers/node3/node.key	pkg=network
2021-12-07T14:13:23-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes357404136/003/TestBeginDiscovery_ThreeNodes/nodeC/node.key	pkg=network
2021-12-07T14:13:23-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:13:23-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:23-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:23-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59954/p2p/12D3KooWPYZTsUTeoXT2Ery2dBPFnZnTBGcrVWdGY1mwAXgTHehS	pkg=network
2021-12-07T14:13:23-04:00 DBUG bootstrapping to peer 12D3KooWLw39ALuGNgEcb8KTyLJzBVuERrw14hDnuhpcQYG4rzGy	pkg=network
2021-12-07T14:13:23-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBannedPeer1916623432/002/TestBannedPeer/nodeB/node.key	pkg=network
2021-12-07T14:13:23-04:00 DBUG bootstrapping to peer 12D3KooWPJBfyy3NJiy3ivLB6YSJoyoa9qje9iDhCo13sHCVEAL6	pkg=network
=== CONT  TestValidateBlockAnnounceHandshake
    testing.go:1152: race detected during execution of test
--- FAIL: TestValidateBlockAnnounceHandshake (1.17s)
=== CONT  TestMessageCacheError
=== CONT  TestHandleLightMessage_Response
--- PASS: TestMessageCacheError (0.01s)
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleLightMessage_Response1285385793/001/TestHandleLightMessage_Response/nodeA/node.key	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_HandleTransaction
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateNotificationsMessageHandler_HandleTransaction (3.61s)
=== CONT  TestDecodeLightMessage
2021-12-07T14:13:24-04:00 DBUG connection successful with peer 12D3KooWLw39ALuGNgEcb8KTyLJzBVuERrw14hDnuhpcQYG4rzGy	pkg=network
=== CONT  TestMDNS
--- PASS: TestDecodeLightMessage (0.01s)
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59955/p2p/12D3KooWRw1WZe6jNM8q72wS3HLtPggqNZJX1PSiPhTQL9kGwmcM	pkg=network
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59956/p2p/12D3KooWK9zC1nuvwRUkc9GipTvRig9Ut8zBJANozXtGyEE6LMfa	pkg=network
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMDNS2830343841/001/TestMDNS/nodeA/node.key	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59957/p2p/12D3KooWEYM5y7VDXxvcG1smx21vh4WVwaizcKFKs6ZcB8zVAj42	pkg=network
2021-12-07T14:13:24-04:00 DBUG connection successful with peer 12D3KooWPJBfyy3NJiy3ivLB6YSJoyoa9qje9iDhCo13sHCVEAL6	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59959/p2p/12D3KooWBJHdzccFeVkfDnE9GbDLSbYX4nQdVs88ZnDERttMuz2F	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59958/p2p/12D3KooWHKzxvy5N1wmY7YJoTLy3APPhXWQ2VdoHirVYmgfq3Nj8	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 DBUG connection dropped successfully for peer 12D3KooWLw39ALuGNgEcb8KTyLJzBVuERrw14hDnuhpcQYG4rzGy	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers3105340035/005/TestMaxPeers/node4/node.key	pkg=network
2021-12-07T14:13:24-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestMinPeers
    testing.go:1152: race detected during execution of test
--- FAIL: TestMinPeers (2.69s)
=== CONT  TestEncodeLightResponse
=== CONT  TestEncodeLightRequest
--- PASS: TestEncodeLightResponse (0.00s)
=== CONT  TestPeerReputation
--- PASS: TestEncodeLightRequest (0.00s)
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerReputation3687856302/001/TestPeerReputation/nodeA/node.key	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:24-04:00 CRIT highest rated peer is below bannedThresholdValue	pkg=peerset
2021-12-07T14:13:24-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59962/p2p/12D3KooWPuVGcHC3kAWF7Mh9XhDjk6TBvkbvuAfz8d1kYaB6yrsE	pkg=network
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMDNS2830343841/002/TestMDNS/nodeB/node.key	pkg=network
2021-12-07T14:13:24-04:00 DBUG starting DHT with bootnodes [{12D3KooWJaqt85p8SvStq5Yw37BmHxLwmNLht9pursKd79PKUowv: [/ip4/127.0.0.1/tcp/59950]} {12D3KooWRw1WZe6jNM8q72wS3HLtPggqNZJX1PSiPhTQL9kGwmcM: [/ip4/127.0.0.1/tcp/59955]}]...	pkg=network
2021-12-07T14:13:24-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleLightMessage_Response1285385793/002/TestHandleLightMessage_Response/nodeB/node.key	pkg=network
2021-12-07T14:13:24-04:00 DBUG connection successful with peer 12D3KooWEYM5y7VDXxvcG1smx21vh4WVwaizcKFKs6ZcB8zVAj42	pkg=network
2021-12-07T14:13:24-04:00 DBUG connection dropped successfully for peer 12D3KooWEYM5y7VDXxvcG1smx21vh4WVwaizcKFKs6ZcB8zVAj42	pkg=network
2021-12-07T14:13:24-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59963/p2p/12D3KooWJxiMFPw43eqznLiq9e1jZbuQNeWUQGo39zhkat9wUZuL	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59964/p2p/12D3KooWDxTCGRpZjKXzoPjpMynq9tWDg7eAPHiabKHh9TvCeuvT	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59965/p2p/12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq	pkg=network
2021-12-07T14:13:25-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 CRIT highest rated peer is below bannedThresholdValue	pkg=peerset
2021-12-07T14:13:25-04:00 DBUG connection successful with peer 12D3KooWCHZMTgNBkfV6wW1grQymbCuyfqPBpsMZTLFLH3BxLZYq	pkg=network
2021-12-07T14:13:25-04:00 DBUG connection successful with peer 12D3KooWCHZMTgNBkfV6wW1grQymbCuyfqPBpsMZTLFLH3BxLZYq	pkg=network
2021-12-07T14:13:25-04:00 DBUG connection successful with peer 12D3KooWCHZMTgNBkfV6wW1grQymbCuyfqPBpsMZTLFLH3BxLZYq	pkg=network
2021-12-07T14:13:25-04:00 DBUG connection successful with peer 12D3KooWCHZMTgNBkfV6wW1grQymbCuyfqPBpsMZTLFLH3BxLZYq	pkg=network
2021-12-07T14:13:25-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerReputation3687856302/002/TestPeerReputation/nodeB/node.key	pkg=network
2021-12-07T14:13:25-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:25-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:25-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59967/p2p/12D3KooWPdQXrSw8unGKpq6PfV6pX3MFDLoTUQg7tSuWj11FDD52	pkg=network
2021-12-07T14:13:25-04:00 WARN ignoring LightRequest without request data	pkg=network
2021-12-07T14:13:25-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:13:25-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/light/2, peer=12D3KooWHKzxvy5N1wmY7YJoTLy3APPhXWQ2VdoHirVYmgfq3Nj8	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to send LightResponse message to peer 12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq: stream closed	pkg=network
2021-12-07T14:13:25-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to send LightResponse message to peer 12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq: stream closed	pkg=network
2021-12-07T14:13:25-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to send LightResponse message to peer 12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq: stream closed	pkg=network
2021-12-07T14:13:25-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to send LightResponse message to peer 12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq: stream closed	pkg=network
2021-12-07T14:13:25-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to send LightResponse message to peer 12D3KooWCYRGEMJT2r7edUwYVgKy9j1btUvXAdjoRD1Uocvgr6tq: stream closed	pkg=network
2021-12-07T14:13:25-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:25-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:13:25-04:00 DBUG starting DHT with bootnodes [{12D3KooWGS94dWHgoBP255gJjsLJeMF2zs4DEyQBGxVwzDfESANJ: [/ip4/127.0.0.1/tcp/59945]}]...	pkg=network
2021-12-07T14:13:25-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
--- PASS: TestHandleLightMessage_Response (2.04s)
=== CONT  TestPeerConnect
=== CONT  TestMaxPeers
    testing.go:1152: race detected during execution of test
--- FAIL: TestMaxPeers (4.53s)
=== CONT  TestStreamCloseEOF
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerConnect2272658741/001/TestPeerConnect/nodeA/node.key	pkg=network
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseEOF2184255775/001/TestStreamCloseEOF/nodeA/node.key	pkg=network
2021-12-07T14:13:26-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 DBUG connection successful with peer 12D3KooWPdQXrSw8unGKpq6PfV6pX3MFDLoTUQg7tSuWj11FDD52	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59968/p2p/12D3KooWGq3yYZs7BdsZ1H3zZsN6A6pN9GgUpbDg1VZmfreGMZxD	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59969/p2p/12D3KooWSTG741mGptDm1fz43uAECcWDuMdL9uu86BbXTJsGvxbS	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c01f1a9c50 by goroutine 54:
  runtime.mapaccess2_faststr()
      /usr/local/go/src/runtime/map_faststr.go:107 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).getNode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:117 +0x8b
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:109 +0x31
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c01f1a9c50 by goroutine 870:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:224 +0x24f
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 870 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x788
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c07fa6cb18 by goroutine 54:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).getNode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:117 +0x99
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:109 +0x31
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c07fa6cb18 by goroutine 870:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:224 +0x25e
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 870 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x788
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c07fa6e6b0 by goroutine 54:
  github.com/ChainSafe/gossamer/dot/peerset.(*node).getReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:92 +0x10a
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:113 +0x117
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c07fa6e6b0 by goroutine 870:
  github.com/ChainSafe/gossamer/dot/peerset.(*node).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:96 +0x1f0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:223 +0x36
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 870 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x788
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Write at 0x00c02970ff90 by goroutine 54:
  runtime.closechan()
      /usr/local/go/src/runtime/chan.go:355 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:144 +0x7e
  github.com/ChainSafe/gossamer/dot/network.(*Service).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:456 +0x223
  github.com/ChainSafe/gossamer/dot/network.createTestService.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:110 +0x4a
  testing.(*common).Cleanup.func1()
      /usr/local/go/src/testing/testing.go:912 +0x199
  testing.(*common).runCleanup()
      /usr/local/go/src/testing/testing.go:1049 +0x154
  testing.tRunner.func2()
      /usr/local/go/src/testing/testing.go:1253 +0x4f
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1265 +0x268
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c02970ff90 by goroutine 762:
  runtime.chansend()
      /usr/local/go/src/runtime/chan.go:158 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Incoming()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:86 +0xc4
  github.com/ChainSafe/gossamer/dot/network.(*Service).handleConn()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:435 +0xfb
  github.com/ChainSafe/gossamer/dot/network.(*Service).handleConn-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:433 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Swarm).addConn·dwrap·13()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm.go:285 +0x58

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 762 (finished) created at:
  github.com/libp2p/go-libp2p-swarm.(*Swarm).addConn()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm.go:285 +0x85b
  github.com/libp2p/go-libp2p-swarm.(*Swarm).dialWorkerLoop()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_dial.go:518 +0x91a
  github.com/libp2p/go-libp2p-swarm.(*Swarm).startDialWorker·dwrap·33()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_dial.go:303 +0x8b
==================
=== CONT  TestPeerReputation
    testing.go:1152: race detected during execution of test
=== CONT  Test_RemoveReservedPeers
--- FAIL: TestPeerReputation (1.79s)
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_RemoveReservedPeers1059118220/001/Test_RemoveReservedPeers/nodeA/node.key	pkg=network
2021-12-07T14:13:26-04:00 WARN failed to open connection for peer 12D3KooWBJHdzccFeVkfDnE9GbDLSbYX4nQdVs88ZnDERttMuz2F: context canceled	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:26-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59970/p2p/12D3KooWEfBTpADoNg2BGu6XmFZZP1h1ktVzKnp7mpZaoUQR6Bug	pkg=network
=== CONT  TestMDNS
    testing.go:1152: race detected during execution of test
--- FAIL: TestMDNS (2.67s)
=== CONT  Test_AddReservedPeers
2021-12-07T14:13:26-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_AddReservedPeers3019080761/001/Test_AddReservedPeers/nodeA/node.key	pkg=network
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerConnect2272658741/002/TestPeerConnect/nodeB/node.key	pkg=network
2021-12-07T14:13:26-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseEOF2184255775/002/TestStreamCloseEOF/nodeB/node.key	pkg=network
2021-12-07T14:13:26-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:26-04:00 DBUG starting DHT with bootnodes [{12D3KooWGS94dWHgoBP255gJjsLJeMF2zs4DEyQBGxVwzDfESANJ: [/ip4/127.0.0.1/tcp/59945]}]...	pkg=network
2021-12-07T14:13:26-04:00 DBUG advertising ourselves in the DHT...	pkg=network
=== CONT  TestMessageCache
    testing.go:1152: race detected during execution of test
--- FAIL: TestMessageCache (3.52s)
=== CONT  TestDecodeBlockAnnounceHandshake
=== CONT  TestExistingStream
--- PASS: TestDecodeBlockAnnounceHandshake (0.00s)
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59971/p2p/12D3KooWMtoCzQeKfpbQAJrMcMXc1DBjpwUuRTTxWdzkh17XtXGc	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59973/p2p/12D3KooWLjKxsGnKz4DZB2nAHA1jHJeBFD5SjhKGzLdEpzWZDTak	pkg=network
2021-12-07T14:13:27-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExistingStream2911109839/001/TestExistingStream/nodeA/node.key	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59972/p2p/12D3KooWLNa524KNkf42uVs8yp7PruowNzquhkmdGH6fyX84gXWX	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59974/p2p/12D3KooWCc17BmNyhPGe31EZXf35tcNpGWgxqtm7T55Yk7hNB3mM	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_RemoveReservedPeers1059118220/002/Test_RemoveReservedPeers/nodeB/node.key	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59975/p2p/12D3KooWGu8AWay6zLia1uzuYfB7D26dDszmfCrmiXBS2EUeZbQf	pkg=network
2021-12-07T14:13:27-04:00 DBUG connection successful with peer 12D3KooWEYM5y7VDXxvcG1smx21vh4WVwaizcKFKs6ZcB8zVAj42	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_AddReservedPeers3019080761/002/Test_AddReservedPeers/nodeB/node.key	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 DBUG connection successful with peer 12D3KooWLNa524KNkf42uVs8yp7PruowNzquhkmdGH6fyX84gXWX	pkg=network
2021-12-07T14:13:27-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExistingStream2911109839/002/TestExistingStream/nodeB/node.key	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59977/p2p/12D3KooWBfojy8rAzuuG6BtFLRUk7f3uixk1qvrR7eDZ2XUKLcNq	pkg=network
2021-12-07T14:13:27-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestPeerConnect
    testing.go:1152: race detected during execution of test
=== CONT  Test_PeerSupportsProtocol
--- FAIL: TestPeerConnect (1.86s)
2021-12-07T14:13:27-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:27-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:13:27-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_PeerSupportsProtocol1347414038/001/Test_PeerSupportsProtocol/nodeA/node.key	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:27-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:27-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59978/p2p/12D3KooWMTXhcor5cm3UtSjnCyzH8zFUYweTtyk1ZuGAKhkDjv1X	pkg=network
2021-12-07T14:13:28-04:00 DBUG connection successful with peer 12D3KooWGu8AWay6zLia1uzuYfB7D26dDszmfCrmiXBS2EUeZbQf	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59979/p2p/12D3KooWNGsy2pRP3LaHwoi1KYw1iuRf19RXAQrKqfenLXMHJgNT	pkg=network
=== CONT  TestBannedPeer
    testing.go:1152: race detected during execution of test
=== CONT  TestStreamCloseMetadataCleanup
--- FAIL: TestBannedPeer (4.97s)
2021-12-07T14:13:28-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseMetadataCleanup3256162339/001/TestStreamCloseMetadataCleanup/nodeA/node.key	pkg=network
--- PASS: Test_RemoveReservedPeers (1.79s)
=== CONT  TestBootstrap
2021-12-07T14:13:28-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBootstrap3693479406/001/TestBootstrap/nodeA/node.key	pkg=network
2021-12-07T14:13:28-04:00 DBUG connection successful with peer 12D3KooWBfojy8rAzuuG6BtFLRUk7f3uixk1qvrR7eDZ2XUKLcNq	pkg=network
2021-12-07T14:13:28-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59981/p2p/12D3KooWKr7iq89unYBqW11k7rJFt7a1DNjmWGbU3hCCiYSza9zJ	pkg=network
2021-12-07T14:13:28.522-0400	ERROR	peerstore/ds	pstoreds/keybook.go:65	error when fetching pubkey from datastore for peer 12D3KooWMtoCzQeKfpbQAJrMcMXc1DBjpwUuRTTxWdzkh17XtXGc: datastore closed

2021-12-07T14:13:28.522-0400	ERROR	peerstore/ds	pstoreds/keybook.go:85	error while updating pubkey in datastore for peer 12D3KooWMtoCzQeKfpbQAJrMcMXc1DBjpwUuRTTxWdzkh17XtXGc: datastore closed

2021-12-07T14:13:28-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:28-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:28-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59982/p2p/12D3KooWRmDfUyKwNFTkQQNpsdRE8Q21mSbSRD9aiR72the2xrua	pkg=network
2021-12-07T14:13:28-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_PeerSupportsProtocol1347414038/002/Test_PeerSupportsProtocol/nodeB/node.key	pkg=network
--- PASS: Test_AddReservedPeers (1.91s)
=== CONT  TestKadDHT
2021-12-07T14:13:28-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT405768787/001/TestKadDHT/node0/node.key	pkg=network
2021-12-07T14:13:28-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestBeginDiscovery_ThreeNodes
    testing.go:1152: race detected during execution of test
--- FAIL: TestBeginDiscovery_ThreeNodes (6.90s)
=== CONT  TestExternalAddrs
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseMetadataCleanup3256162339/002/TestStreamCloseMetadataCleanup/nodeB/node.key	pkg=network
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExternalAddrs2400874626/001/TestExternalAddrs/node/node.key	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59984/p2p/12D3KooWLP2jh5NMPRYb7t3DBwhWB3v7nL1nsMhHH6CoR5mjWWEv	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59983/p2p/12D3KooWANZeVoGirdBVW7x8AuVy3Y9asB8RKZFTsiXeQ2etD3Sk	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBootstrap3693479406/002/TestBootstrap/nodeB/node.key	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59985/p2p/12D3KooWFDZ5VvnUpRFMxFiYLs1ezhk756H3RndCfymFKph6R2au	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59986/p2p/12D3KooWR96FutV7e34ffJ8L1QEGKypxPNg41CKfij4Hv4VqW6Nq	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59987/p2p/12D3KooWQiS5E4dnx98557Z1XWMmCTFQFd6Fp2hX9WVKrxMqdVsF	pkg=network
2021-12-07T14:13:29-04:00 DBUG bootstrapping to peer 12D3KooWRmDfUyKwNFTkQQNpsdRE8Q21mSbSRD9aiR72the2xrua	pkg=network
2021-12-07T14:13:29-04:00 DBUG connection successful with peer 12D3KooWRmDfUyKwNFTkQQNpsdRE8Q21mSbSRD9aiR72the2xrua	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT405768787/002/TestKadDHT/node1/node.key	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c011d60c00 by goroutine 46:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:262 +0xcbc
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c011d60c00 by goroutine 760:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 760 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c07c216348 by goroutine 46:
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:262 +0xcc9
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c07c216348 by goroutine 760:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 760 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:29-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59988/p2p/12D3KooWFSj8LWMxYmWLGtM2kTn8c1TzRQ1jM2Mj2sKMeHjy8cLq	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:29-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  Test_PeerSupportsProtocol
    testing.go:1152: race detected during execution of test
=== CONT  TestGossip
--- FAIL: Test_PeerSupportsProtocol (1.97s)
=== CONT  TestExternalAddrs
    testing.go:1152: race detected during execution of test
--- FAIL: TestExternalAddrs (0.97s)
=== CONT  TestBeginDiscovery
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip895427803/001/TestGossip/nodeA/node.key	pkg=network
2021-12-07T14:13:29-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery178887698/001/TestBeginDiscovery/nodeA/node.key	pkg=network
=== CONT  TestBootstrap
    testing.go:1152: race detected during execution of test
--- FAIL: TestBootstrap (1.76s)
=== CONT  TestDecodeBlockAnnounce
=== CONT  TestRemovePeer
--- PASS: TestDecodeBlockAnnounce (0.01s)
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestRemovePeer2125252212/001/TestRemovePeer/nodeA/node.key	pkg=network
2021-12-07T14:13:30-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT405768787/003/TestKadDHT/node2/node.key	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59990/p2p/12D3KooWRDdyRV4NcrUfntZq1HT24endCd24ETZEEpTDxVeM6bgJ	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59989/p2p/12D3KooWRyuWZXx64qSAJ2P7mn1X6qjEDdart6AFN7Sput3dQ8Ws	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59991/p2p/12D3KooWG2h62eyKABYVqDte91DXYFSRiCp9nwanNRHhroB6WKei	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59992/p2p/12D3KooWAZYZffKrZRV1JVFiX8FFRzpu2ZCVFasNAHLFWGprZyAs	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c0993f22d0 by goroutine 46:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:274 +0x1008
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0993f22d0 by goroutine 242:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 242 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c087c0afa8 by goroutine 46:
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:274 +0x1015
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c087c0afa8 by goroutine 242:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 242 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:13:30-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
2021-12-07T14:13:30-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
=== CONT  TestExistingStream
    testing.go:1152: race detected during execution of test
=== CONT  TestSetReservedPeer
--- FAIL: TestExistingStream (3.67s)
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer3019108975/001/TestSetReservedPeer/node0/node.key	pkg=network
2021-12-07T14:13:30-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip895427803/002/TestGossip/nodeB/node.key	pkg=network
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery178887698/002/TestBeginDiscovery/nodeB/node.key	pkg=network
2021-12-07T14:13:30-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWKr7iq89unYBqW11k7rJFt7a1DNjmWGbU3hCCiYSza9zJ	pkg=network
2021-12-07T14:13:30-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestRemovePeer2125252212/002/TestRemovePeer/nodeB/node.key	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:30-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:30-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59993/p2p/12D3KooWRthmCTEVv2Q6Xe3fMh1naV3GyFLWbZdK8UCM38dD3G5v	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59994/p2p/12D3KooWEamHFCn6pt64yC4uBxSrVjbaBHkZxMDt4oK3dM2Dj7ta	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59995/p2p/12D3KooWJYWjwcZRSGabLERrfQ3y4SPd7hKNW3y2Gb7Dky66rKY4	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59996/p2p/12D3KooWRs5yXnnoGYqrnNFWRT4MnyqB8o23rRGKzV4p6F2cVs3S	pkg=network
2021-12-07T14:13:31-04:00 DBUG bootstrapping to peer 12D3KooWG2h62eyKABYVqDte91DXYFSRiCp9nwanNRHhroB6WKei	pkg=network
2021-12-07T14:13:31-04:00 DBUG connection successful with peer 12D3KooWG2h62eyKABYVqDte91DXYFSRiCp9nwanNRHhroB6WKei	pkg=network
2021-12-07T14:13:31-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer3019108975/002/TestSetReservedPeer/node1/node.key	pkg=network
2021-12-07T14:13:31-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59998/p2p/12D3KooWCJhX3eqajv6XKS9gLuMPXBe8BwnffTsN3hjaXXacSg4N	pkg=network
2021-12-07T14:13:31-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 DBUG starting DHT with bootnodes [{12D3KooWEamHFCn6pt64yC4uBxSrVjbaBHkZxMDt4oK3dM2Dj7ta: [/ip4/127.0.0.1/tcp/59994]}]...	pkg=network
2021-12-07T14:13:31-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip895427803/003/TestGossip/nodeC/node.key	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:31-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:31-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/59999/p2p/12D3KooWNvdCqmee1yea1gVzYqxDkDxso3BQDEe3ySFLPgtSfTqS	pkg=network
=== CONT  TestStreamCloseMetadataCleanup
    testing.go:1152: race detected during execution of test
=== CONT  TestPersistentPeers
--- FAIL: TestStreamCloseMetadataCleanup (3.85s)
2021-12-07T14:13:32-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistentPeers2702038506/001/TestPersistentPeers/node-a/node.key	pkg=network
2021-12-07T14:13:32-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer3019108975/003/TestSetReservedPeer/node2/node.key	pkg=network
2021-12-07T14:13:32-04:00 DBUG connection dropped successfully for peer 12D3KooWG2h62eyKABYVqDte91DXYFSRiCp9nwanNRHhroB6WKei	pkg=network
2021-12-07T14:13:32-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:32-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60000/p2p/12D3KooWRp6BsCzQ3kjHsEoyWEi6YJEsTEEEToBkrtvJkt5XpDcq	pkg=network
2021-12-07T14:13:32-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:32-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60001/p2p/12D3KooWGJJ6aKHw6dCVRCJxt3h4NBdJFz36reTn5r6WTrewHLbD	pkg=network
=== CONT  TestGossip
    gossip_test.go:93: 
        	Error Trace:	gossip_test.go:93
        	Error:      	Received unexpected error:
        	            	protocol not supported
        	Test:       	TestGossip
2021-12-07T14:13:32-04:00 DBUG cleaning up outbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA	pkg=network
2021-12-07T14:13:32-04:00 DBUG failed to send handshake to peer 12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA on protocol /gossamer/test/0/block-announces/1: handshake timeout reached	pkg=network
2021-12-07T14:13:32-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:13:32-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c0966643e8 by goroutine 51:
  github.com/ChainSafe/gossamer/dot/network.TestStreamCloseEOF()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:555 +0xa5e
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0966643e8 by goroutine 267:
  [failed to restore the stack]

Goroutine 51 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
    testing.go:1152: race detected during execution of test
--- FAIL: TestGossip (2.83s)
2021-12-07T14:13:32-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:32-04:00 DBUG starting DHT with bootnodes [{12D3KooWRDdyRV4NcrUfntZq1HT24endCd24ETZEEpTDxVeM6bgJ: [/ip4/127.0.0.1/tcp/59990]}]...	pkg=network
=== CONT  TestRemovePeer
    testing.go:1152: race detected during execution of test
--- FAIL: TestRemovePeer (2.63s)
2021-12-07T14:13:32-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:32-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistentPeers2702038506/002/TestPersistentPeers/node-b/node.key	pkg=network
2021-12-07T14:13:32-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer3019108975/004/TestSetReservedPeer/node3/node.key	pkg=network
2021-12-07T14:13:32-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
2021-12-07T14:13:32-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
=== CONT  TestStreamCloseEOF
    testing.go:1152: race detected during execution of test
--- FAIL: TestStreamCloseEOF (6.85s)
2021-12-07T14:13:33-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:33-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:33-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60002/p2p/12D3KooWPWtE1R97W1qhYe7UCJxsQNbLdqAQJz7FXU9VUEPpFWEr	pkg=network
2021-12-07T14:13:33-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:13:33-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:33-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60003/p2p/12D3KooWCnonerXtebvBehM7QNPFpmfnTAaktauJai3CY1Y57RdB	pkg=network
2021-12-07T14:13:33-04:00 DBUG connection successful with peer 12D3KooWRp6BsCzQ3kjHsEoyWEi6YJEsTEEEToBkrtvJkt5XpDcq	pkg=network
2021-12-07T14:13:33-04:00 DBUG connection successful with peer 12D3KooWRthmCTEVv2Q6Xe3fMh1naV3GyFLWbZdK8UCM38dD3G5v	pkg=network
2021-12-07T14:13:33-04:00 DBUG connection successful with peer 12D3KooWCJhX3eqajv6XKS9gLuMPXBe8BwnffTsN3hjaXXacSg4N	pkg=network
2021-12-07T14:13:33-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:13:33-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  Test_HandshakeTimeout
    testing.go:1152: race detected during execution of test
--- FAIL: Test_HandshakeTimeout (12.75s)
2021-12-07T14:13:33-04:00 DBUG DHT discovery started!	pkg=network
=== CONT  TestBeginDiscovery
    testing.go:1152: race detected during execution of test
--- FAIL: TestBeginDiscovery (3.96s)
2021-12-07T14:13:34-04:00 DBUG connection dropped successfully for peer 12D3KooWPWtE1R97W1qhYe7UCJxsQNbLdqAQJz7FXU9VUEPpFWEr	pkg=network
2021-12-07T14:13:34-04:00 DBUG connection successful with peer 12D3KooWPWtE1R97W1qhYe7UCJxsQNbLdqAQJz7FXU9VUEPpFWEr	pkg=network
2021-12-07T14:13:34-04:00 DBUG connection successful with peer 12D3KooWGJJ6aKHw6dCVRCJxt3h4NBdJFz36reTn5r6WTrewHLbD	pkg=network
=== CONT  TestSetReservedPeer
    testing.go:1152: race detected during execution of test
--- FAIL: TestSetReservedPeer (4.04s)
=== CONT  TestPersistentPeers
    testing.go:1152: race detected during execution of test
--- FAIL: TestPersistentPeers (2.75s)
2021-12-07T14:13:39-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:13:39-04:00 DBUG starting DHT with bootnodes [{12D3KooWAZYZffKrZRV1JVFiX8FFRzpu2ZCVFasNAHLFWGprZyAs: [/ip4/127.0.0.1/tcp/59992]}]...	pkg=network
2021-12-07T14:13:40-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:13:40-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:40-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:13:40-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
2021-12-07T14:13:40-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:13:40-04:00 DBUG starting DHT with bootnodes [{12D3KooWLP2jh5NMPRYb7t3DBwhWB3v7nL1nsMhHH6CoR5mjWWEv: [/ip4/127.0.0.1/tcp/59984]}]...	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c03aee0990 by goroutine 37:
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x264
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c03aee0990 by goroutine 820:
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:108 +0x6b2
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 37 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2b402a0 by goroutine 401:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x111

Previous write at 0x00c0d2b402a0 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:139 +0x93d
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ab9500 by goroutine 401:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindLocal()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:714 +0x5d
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:625 +0x1b1
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ab9500 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2b402a8 by goroutine 780:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x115

Previous write at 0x00c0d2b402a8 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:139 +0x93d
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 780 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ce2000 by goroutine 780:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindLocal()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:714 +0x5d
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:625 +0x1b1
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c0d2ce2000 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 780 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ab9558 by goroutine 401:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x126
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ab9558 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ce2058 by goroutine 780:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x126
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c0d2ce2058 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 780 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ce2930 by goroutine 780:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x146
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c0d2ce2930 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 780 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2aba258 by goroutine 780:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:388 +0x70
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c0d2aba258 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 780 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ab9e30 by goroutine 401:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x146
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ab9e30 by goroutine 820:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2aba198 by goroutine 401:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:388 +0x70
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2aba198 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2aba1e0 by goroutine 401:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:394 +0xde
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2aba1e0 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2aba1f8 by goroutine 401:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:399 +0x148
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2aba1f8 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ae81e8 by goroutine 401:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2ab
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ae81e8 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1c4
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ae81e0 by goroutine 401:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2cb
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ae81e0 by goroutine 820:
  github.com/libp2p/go-libp2p-kbucket.newBucket()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/bucket.go:45 +0x12a
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1ad
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0d2ae3b28 by goroutine 401:
  container/list.(*List).Front()
      /usr/local/go/src/container/list/list.go:70 +0x57
  github.com/libp2p/go-libp2p-kbucket.(*peerDistanceSorter).appendPeersFromList()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/sorting.go:40 +0x69
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2e4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c0d2ae3b28 by goroutine 820:
  container/list.(*List).Init()
      /usr/local/go/src/container/list/list.go:57 +0x113
  container/list.New()
      /usr/local/go/src/container/list/list.go:62 +0x96
  github.com/libp2p/go-libp2p-kbucket.newBucket()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/bucket.go:45 +0x121
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1ad
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 401 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 820 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
2021-12-07T14:13:41-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:41-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:13:50-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:13:50-04:00 DBUG starting DHT with bootnodes [{12D3KooWLP2jh5NMPRYb7t3DBwhWB3v7nL1nsMhHH6CoR5mjWWEv: [/ip4/127.0.0.1/tcp/59984]}]...	pkg=network
2021-12-07T14:13:51-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:13:51-04:00 DBUG advertising ourselves in the DHT...	pkg=network
=== CONT  TestKadDHT
    testing.go:1152: race detected during execution of test
--- FAIL: TestKadDHT (22.76s)
FAIL
FAIL	github.com/ChainSafe/gossamer/dot/network	34.988s
FAIL
