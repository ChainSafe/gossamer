=== RUN   TestEncodeBlockAnnounce
=== PAUSE TestEncodeBlockAnnounce
=== RUN   TestDecodeBlockAnnounce
=== PAUSE TestDecodeBlockAnnounce
=== RUN   TestEncodeBlockAnnounceHandshake
=== PAUSE TestEncodeBlockAnnounceHandshake
=== RUN   TestDecodeBlockAnnounceHandshake
=== PAUSE TestDecodeBlockAnnounceHandshake
=== RUN   TestHandleBlockAnnounceMessage
=== PAUSE TestHandleBlockAnnounceMessage
=== RUN   TestValidateBlockAnnounceHandshake
=== PAUSE TestValidateBlockAnnounceHandshake
=== RUN   TestBuildIdentity
=== PAUSE TestBuildIdentity
=== RUN   TestBuild
=== PAUSE TestBuild
=== RUN   TestMinPeers
=== PAUSE TestMinPeers
=== RUN   TestMaxPeers
=== PAUSE TestMaxPeers
=== RUN   TestProtectUnprotectPeer
=== PAUSE TestProtectUnprotectPeer
=== RUN   TestPersistentPeers
=== PAUSE TestPersistentPeers
=== RUN   TestRemovePeer
=== PAUSE TestRemovePeer
=== RUN   TestSetReservedPeer
=== PAUSE TestSetReservedPeer
=== RUN   TestKadDHT
=== PAUSE TestKadDHT
=== RUN   TestBeginDiscovery
=== PAUSE TestBeginDiscovery
=== RUN   TestBeginDiscovery_ThreeNodes
=== PAUSE TestBeginDiscovery_ThreeNodes
=== RUN   TestGossip
=== PAUSE TestGossip
=== RUN   TestExternalAddrs
=== PAUSE TestExternalAddrs
=== RUN   TestExternalAddrsPublicIP
=== PAUSE TestExternalAddrsPublicIP
=== RUN   TestConnect
=== PAUSE TestConnect
=== RUN   TestBootstrap
=== PAUSE TestBootstrap
=== RUN   TestSend
=== PAUSE TestSend
=== RUN   TestExistingStream
=== PAUSE TestExistingStream
=== RUN   TestStreamCloseMetadataCleanup
=== PAUSE TestStreamCloseMetadataCleanup
=== RUN   Test_PeerSupportsProtocol
=== PAUSE Test_PeerSupportsProtocol
=== RUN   Test_AddReservedPeers
=== PAUSE Test_AddReservedPeers
=== RUN   Test_RemoveReservedPeers
=== PAUSE Test_RemoveReservedPeers
=== RUN   TestStreamCloseEOF
=== PAUSE TestStreamCloseEOF
=== RUN   TestPeerConnect
=== PAUSE TestPeerConnect
=== RUN   TestBannedPeer
=== PAUSE TestBannedPeer
=== RUN   TestPeerReputation
=== PAUSE TestPeerReputation
=== RUN   TestEncodeLightRequest
=== PAUSE TestEncodeLightRequest
=== RUN   TestEncodeLightResponse
=== PAUSE TestEncodeLightResponse
=== RUN   TestDecodeLightMessage
=== PAUSE TestDecodeLightMessage
=== RUN   TestHandleLightMessage_Response
=== PAUSE TestHandleLightMessage_Response
=== RUN   TestMDNS
=== PAUSE TestMDNS
=== RUN   TestMessageCache
=== PAUSE TestMessageCache
=== RUN   TestMessageCacheError
=== PAUSE TestMessageCacheError
=== RUN   TestEncodeBlockRequestMessage
=== PAUSE TestEncodeBlockRequestMessage
=== RUN   TestEncodeBlockRequestMessage_BlockHash
=== PAUSE TestEncodeBlockRequestMessage_BlockHash
=== RUN   TestEncodeBlockRequestMessage_BlockNumber
=== PAUSE TestEncodeBlockRequestMessage_BlockNumber
=== RUN   TestBlockRequestString
=== PAUSE TestBlockRequestString
=== RUN   TestEncodeBlockRequestMessage_NoOptionals
=== PAUSE TestEncodeBlockRequestMessage_NoOptionals
=== RUN   TestEncodeBlockResponseMessage_Empty
=== PAUSE TestEncodeBlockResponseMessage_Empty
=== RUN   TestEncodeBlockResponseMessage_WithBody
=== PAUSE TestEncodeBlockResponseMessage_WithBody
=== RUN   TestEncodeBlockResponseMessage_WithAll
=== PAUSE TestEncodeBlockResponseMessage_WithAll
=== RUN   TestEncodeBlockAnnounceMessage
=== PAUSE TestEncodeBlockAnnounceMessage
=== RUN   TestDecode_BlockAnnounceMessage
=== PAUSE TestDecode_BlockAnnounceMessage
=== RUN   TestEncodeTransactionMessageSingleExtrinsic
=== PAUSE TestEncodeTransactionMessageSingleExtrinsic
=== RUN   TestEncodeTransactionMessageTwoExtrinsics
=== PAUSE TestEncodeTransactionMessageTwoExtrinsics
=== RUN   TestDecodeTransactionMessageOneExtrinsic
=== PAUSE TestDecodeTransactionMessageOneExtrinsic
=== RUN   TestDecodeTransactionMessageTwoExtrinsics
=== PAUSE TestDecodeTransactionMessageTwoExtrinsics
=== RUN   TestDecodeConsensusMessage
=== PAUSE TestDecodeConsensusMessage
=== RUN   TestCreateDecoder_BlockAnnounce
=== PAUSE TestCreateDecoder_BlockAnnounce
=== RUN   TestCreateNotificationsMessageHandler_BlockAnnounce
=== PAUSE TestCreateNotificationsMessageHandler_BlockAnnounce
=== RUN   TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
=== PAUSE TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
=== RUN   Test_HandshakeTimeout
=== PAUSE Test_HandshakeTimeout
=== RUN   TestCreateNotificationsMessageHandler_HandleTransaction
=== PAUSE TestCreateNotificationsMessageHandler_HandleTransaction
=== RUN   TestBlockAnnounceHandshakeSize
=== PAUSE TestBlockAnnounceHandshakeSize
=== RUN   Test_sizedBufferPool
=== PAUSE Test_sizedBufferPool
=== RUN   Test_sizedBufferPool_race
=== PAUSE Test_sizedBufferPool_race
=== RUN   TestStartService
=== PAUSE TestStartService
=== RUN   TestBroadcastMessages
=== PAUSE TestBroadcastMessages
=== RUN   TestBroadcastDuplicateMessage
=== PAUSE TestBroadcastDuplicateMessage
=== RUN   TestService_NodeRoles
=== PAUSE TestService_NodeRoles
=== RUN   TestService_Health
=== PAUSE TestService_Health
=== RUN   TestPersistPeerStore
=== PAUSE TestPersistPeerStore
=== RUN   TestHandleConn
=== PAUSE TestHandleConn
=== RUN   TestSerivceIsMajorSyncMetrics
=== PAUSE TestSerivceIsMajorSyncMetrics
=== RUN   TestStreamManager
=== PAUSE TestStreamManager
=== RUN   TestStreamManager_KeepStream
    stream_manager_test.go:91: 
--- SKIP: TestStreamManager_KeepStream (0.00s)
=== RUN   TestDecodeSyncMessage
=== PAUSE TestDecodeSyncMessage
=== RUN   TestDecodeTransactionHandshake
=== PAUSE TestDecodeTransactionHandshake
=== RUN   TestHandleTransactionMessage
=== PAUSE TestHandleTransactionMessage
=== RUN   TestStringToAddrInfo
--- PASS: TestStringToAddrInfo (0.00s)
=== RUN   TestStringsToAddrInfos
--- PASS: TestStringsToAddrInfos (0.00s)
=== RUN   TestGenerateKey
--- PASS: TestGenerateKey (0.01s)
=== RUN   TestReadLEB128ToUint64
--- PASS: TestReadLEB128ToUint64 (0.00s)
=== RUN   TestInvalidLeb128
--- PASS: TestInvalidLeb128 (0.00s)
=== CONT  TestService_Health
=== CONT  Test_HandshakeTimeout
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
=== CONT  TestHandleTransactionMessage
=== CONT  TestCreateNotificationsMessageHandler_HandleTransaction
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounce
=== CONT  TestBlockRequestString
=== CONT  TestPeerConnect
BlockRequestMessage RequestedData=1 StartingBlock={[220 209 52 103 1 202 131 150 73 110 82 170 39 133 177 116 141 235 109 176 149 81 183 33 89 220 179 224 137 145 2 91]} EndBlockHash=0x0000000000000000000000000000000000000000000000000000000000000000 Direction=1 Max=0
=== CONT  TestEncodeBlockAnnounce
--- PASS: TestBlockRequestString (0.00s)
--- PASS: TestEncodeBlockAnnounce (0.00s)
=== CONT  Test_RemoveReservedPeers
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounce240727509/001/TestCreateNotificationsMessageHandler_BlockAnnounce/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestService_Health3796617253/001/TestService_Health/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_HandshakeTimeout3557874362/001/Test_HandshakeTimeout/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerConnect3781788135/001/TestPeerConnect/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleTransactionMessage963487009/001/TestHandleTransactionMessage/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_HandleTransaction3837544442/001/TestCreateNotificationsMessageHandler_HandleTransaction/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_RemoveReservedPeers2521351122/001/Test_RemoveReservedPeers/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake2739113968/001/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake/nodeA/node.key	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60465/p2p/12D3KooWNGxiQWyH4dGwjVKQnWYak7hfFbPkRwASB1jdEphNKU1V	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60468/p2p/12D3KooWKp8GjqHCD94dRpYaoKzXM1y177novprk23Pd8j1VMjEv	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60470/p2p/12D3KooWLAR9uEeYo34TLbLjivn9nP4vboa62VZXrP3qRzoi76qp	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60463/p2p/12D3KooWJc3vihKem9XNyoPZVq9doAZEfpC2AD3Zrw5MQBJrd9dG	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60464/p2p/12D3KooWPys2ogCJ8qhs1GJU1onY8fWKKmnkMEAKu8CzPm4zWzTm	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60469/p2p/12D3KooWMYGhNLRaDTiqHXHwhh1D6jX5ZLaDjyDhEXyhTDeSyaRH	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60466/p2p/12D3KooWSc3uKbAr8G9GMssaEnzrNQ2KfmFUUMuqWj38YkM9kZ9d	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:53-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:53-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60467/p2p/12D3KooWHmZxof4Qs2FjEkGQX7rDVHxZpg6htDPSyVZtqunG2KgG	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
==================
WARNING: DATA RACE
Read at 0x000005eb97c0 by goroutine 483:
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:77 +0x30
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x184
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Previous write at 0x000005eb97c0 by goroutine 479:
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:80 +0x1b9
  sync.(*Once).doSlow()
      /usr/local/go/src/sync/once.go:68 +0x127
  sync.(*Once).Do()
      /usr/local/go/src/sync/once.go:59 +0x46
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:78 +0x4d
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x184
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Goroutine 483 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.Test_HandshakeTimeout()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:241 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 479 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestCreateNotificationsMessageHandler_BlockAnnounce()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:100 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c001126210 by goroutine 483:
  github.com/ChainSafe/gossamer/dot/telemetry.(*Handler).SendMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:126 +0x69
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x4b5
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Previous write at 0x00c001126210 by goroutine 479:
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:80 +0xaa
  sync.(*Once).doSlow()
      /usr/local/go/src/sync/once.go:68 +0x127
  sync.(*Once).Do()
      /usr/local/go/src/sync/once.go:59 +0x46
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:78 +0x4d
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x184
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Goroutine 483 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.Test_HandshakeTimeout()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:241 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 479 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestCreateNotificationsMessageHandler_BlockAnnounce()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:100 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0011261e0 by goroutine 483:
  github.com/ChainSafe/gossamer/dot/telemetry.(*Handler).SendMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:129 +0xd9
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x4b5
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Previous write at 0x00c0011261e0 by goroutine 479:
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:80 +0xaa
  sync.(*Once).doSlow()
      /usr/local/go/src/sync/once.go:68 +0x127
  sync.(*Once).Do()
      /usr/local/go/src/sync/once.go:59 +0x46
  github.com/ChainSafe/gossamer/dot/telemetry.GetInstance()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/telemetry/telemetry.go:78 +0x4d
  github.com/ChainSafe/gossamer/dot/network.(*Service).sentBlockIntervalTelemetry()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:418 +0x184
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start·dwrap·14()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x39

Goroutine 483 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.Test_HandshakeTimeout()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:241 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 479 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:283 +0x134a
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestCreateNotificationsMessageHandler_BlockAnnounce()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications_test.go:100 +0x1a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounce240727509/002/TestCreateNotificationsMessageHandler_BlockAnnounce/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 2 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_HandshakeTimeout3557874362/002/Test_HandshakeTimeout/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerConnect3781788135/002/TestPeerConnect/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_HandleTransaction3837544442/002/TestCreateNotificationsMessageHandler_HandleTransaction/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake2739113968/002/TestCreateNotificationsMessageHandler_BlockAnnounceHandshake/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_RemoveReservedPeers2521351122/002/Test_RemoveReservedPeers/nodeB/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60471/p2p/12D3KooWH5fwTfbUGCsqQycKdfy1JVuTAtzFe75TZwqTJvKy62CY	pkg=network
=== CONT  TestHandleTransactionMessage
    testing.go:1152: race detected during execution of test
=== CONT  TestStreamCloseEOF
--- FAIL: TestHandleTransactionMessage (1.36s)
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60472/p2p/12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA	pkg=network
=== CONT  TestService_Health
    testing.go:1152: race detected during execution of test
--- FAIL: TestService_Health (1.39s)
=== CONT  Test_AddReservedPeers
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseEOF3490846028/001/TestStreamCloseEOF/nodeA/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60473/p2p/12D3KooWHMF8u1apPQfasN1tyFAmDwsuYg1xSTcUFgiBW4x5MdQV	pkg=network
2021-12-07T14:25:54-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_AddReservedPeers4152160875/001/Test_AddReservedPeers/nodeA/node.key	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60474/p2p/12D3KooWQ8cVoRHtihDUc9LZ4VZEqCMGAg4LdRHDzQc2sCVywNHq	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60475/p2p/12D3KooWNF5MGqwybDdj3yetjcsSiH7NQ1Ua6A2BzTCd1y3xeAF5	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:54-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:54-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60476/p2p/12D3KooWApkKFJMF2jquCuxCmLAagbsTPCk6YFFPkgX35Re3Aynw	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60477/p2p/12D3KooWMtvPqGaDc7rUa2qwxXdhTjCEk12VJNgyPCQVHJQRNmUY	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60478/p2p/12D3KooWBVWbZirA2TAs9JA8t5DW5xPxdJDvTNPnp6S6nzJC7wbq	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 DBUG gossiping from host 12D3KooWKp8GjqHCD94dRpYaoKzXM1y177novprk23Pd8j1VMjEv message of type 0: BlockAnnounceHandshake Roles=4 BestBlockNumber=77 BestBlockHash=0x0100000000000000000000000000000000000000000000000000000000000000 GenesisHash=0x0200000000000000000000000000000000000000000000000000000000000000	pkg=network
2021-12-07T14:25:55-04:00 EROR message type 0 not supported by any notifications protocol	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounce
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateNotificationsMessageHandler_BlockAnnounce (2.05s)
=== CONT  Test_PeerSupportsProtocol
2021-12-07T14:25:55-04:00 DBUG connection successful with peer 12D3KooWHMF8u1apPQfasN1tyFAmDwsuYg1xSTcUFgiBW4x5MdQV	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_PeerSupportsProtocol429121497/001/Test_PeerSupportsProtocol/nodeA/node.key	pkg=network
2021-12-07T14:25:55-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWPys2ogCJ8qhs1GJU1onY8fWKKmnkMEAKu8CzPm4zWzTm	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 DBUG connection successful with peer 12D3KooWApkKFJMF2jquCuxCmLAagbsTPCk6YFFPkgX35Re3Aynw	pkg=network
2021-12-07T14:25:55-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseEOF3490846028/002/TestStreamCloseEOF/nodeB/node.key	pkg=network
2021-12-07T14:25:55-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_AddReservedPeers4152160875/002/Test_AddReservedPeers/nodeB/node.key	pkg=network
2021-12-07T14:25:55-04:00 DBUG transaction message TransactionMessage extrinsics count=2 for peer 12D3KooWQ8cVoRHtihDUc9LZ4VZEqCMGAg4LdRHDzQc2sCVywNHq not included into batch	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60479/p2p/12D3KooWAoNZqkchZZSiYd44oJUubNTdTJjtvBNEcrxW2kEghWKY	pkg=network
=== CONT  TestPeerConnect
    testing.go:1152: race detected during execution of test
--- FAIL: TestPeerConnect (2.44s)
=== CONT  TestExistingStream
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60481/p2p/12D3KooWRNoSPiWz9ZFCu5cptHEfoDwgHZ8dNaBGjKxcAUr6Z4JE	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_BlockAnnounceHandshake
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateNotificationsMessageHandler_BlockAnnounceHandshake (2.51s)
=== CONT  TestSend
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:55-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:55-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExistingStream3117877671/001/TestExistingStream/nodeA/node.key	pkg=network
2021-12-07T14:25:55-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60480/p2p/12D3KooWMXKyDcmKYNKAh8qtcNz2zLfL8pEehYqTiJ7nr1uHmMq2	pkg=network
2021-12-07T14:25:55-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSend1207489262/001/TestSend/nodeA/node.key	pkg=network
=== CONT  Test_RemoveReservedPeers
    testing.go:1152: race detected during execution of test
--- FAIL: Test_RemoveReservedPeers (2.66s)
=== CONT  TestBootstrap
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBootstrap2218600355/001/TestBootstrap/nodeA/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60482/p2p/12D3KooWMoKQwojF8PuFQEKrXMPrDxA6NrypJYp5zdbhqmzWuei6	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60483/p2p/12D3KooWAoogJZXYBsjDCJfw8cvBtV1FB7y2Ksnk61LH5moLsR3A	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/Test_PeerSupportsProtocol429121497/002/Test_PeerSupportsProtocol/nodeB/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60484/p2p/12D3KooWLTtCxo1JmNGDbUR31FtrPLT8r2f7G8bGx7E34PDxQnTS	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60486/p2p/12D3KooWAneXjHxbLSAHKiHJWHPDLr6AQYqaTp6T2UYDbPwPsUeX	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 DBUG connection successful with peer 12D3KooWMXKyDcmKYNKAh8qtcNz2zLfL8pEehYqTiJ7nr1uHmMq2	pkg=network
=== CONT  TestDecodeTransactionHandshake
--- PASS: Test_AddReservedPeers (1.84s)
=== CONT  TestDecode_BlockAnnounceMessage
--- PASS: TestDecodeTransactionHandshake (0.00s)
=== CONT  TestCreateDecoder_BlockAnnounce
--- PASS: TestDecode_BlockAnnounceMessage (0.00s)
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestCreateDecoder_BlockAnnounce3301027701/001/TestCreateDecoder_BlockAnnounce/nodeA/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExistingStream3117877671/002/TestExistingStream/nodeB/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSend1207489262/002/TestSend/nodeB/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBootstrap2218600355/002/TestBootstrap/nodeB/node.key	pkg=network
2021-12-07T14:25:56-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60487/p2p/12D3KooWDyzuBbXpQvkkmAs1yCrE3omFUUy5JNMpCtHXDTqzE7gV	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60488/p2p/12D3KooWKCKAyUVV25r3NVSEfa2oFQtvHBsik6zx5fXV4AG5UNmJ	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:56-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:56-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60489/p2p/12D3KooWNuEDwsY4v77dp5zEAFbkLFrxwpq35CQHxpLHXLXDBgTZ	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60490/p2p/12D3KooWM5a9c9ENop9Yr4cbGG2ACBpsyW5e74CHvcg8RpD5tQ9F	pkg=network
2021-12-07T14:25:57-04:00 DBUG bootstrapping to peer 12D3KooWLTtCxo1JmNGDbUR31FtrPLT8r2f7G8bGx7E34PDxQnTS	pkg=network
2021-12-07T14:25:57-04:00 DBUG connection successful with peer 12D3KooWLTtCxo1JmNGDbUR31FtrPLT8r2f7G8bGx7E34PDxQnTS	pkg=network
=== CONT  TestCreateNotificationsMessageHandler_HandleTransaction
    testing.go:1152: race detected during execution of test
--- FAIL: TestCreateNotificationsMessageHandler_HandleTransaction (3.85s)
=== CONT  TestDecodeTransactionMessageTwoExtrinsics
=== CONT  TestDecodeConsensusMessage
--- PASS: TestDecodeTransactionMessageTwoExtrinsics (0.00s)
--- PASS: Test_PeerSupportsProtocol (1.81s)
=== CONT  TestEncodeTransactionMessageTwoExtrinsics
=== CONT  TestDecodeTransactionMessageOneExtrinsic
--- PASS: TestDecodeConsensusMessage (0.00s)
=== CONT  TestHandleConn
--- PASS: TestEncodeTransactionMessageTwoExtrinsics (0.00s)
=== CONT  TestDecodeSyncMessage
--- PASS: TestDecodeTransactionMessageOneExtrinsic (0.00s)
=== CONT  TestPersistPeerStore
--- PASS: TestDecodeSyncMessage (0.00s)
2021-12-07T14:25:57-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleConn2162876927/001/TestHandleConn/nodeA/node.key	pkg=network
2021-12-07T14:25:57-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistPeerStore4076152564/001/TestPersistPeerStore/node0/node.key	pkg=network
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60492/p2p/12D3KooWGeN7T72ianzPN2q4j3u7sPX8ArYwRSEzwqu8G3FfgEf1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60491/p2p/12D3KooWCeHGrmZpZaEvqp8uEC5b68eQzoiPvJdUo2GV2du1NcvY	pkg=network
--- PASS: TestCreateDecoder_BlockAnnounce (0.86s)
=== CONT  TestStreamManager
==================
WARNING: DATA RACE
Write at 0x000005df4ec8 by goroutine 93:
  github.com/ChainSafe/gossamer/dot/network.setupStreamManagerTest()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/stream_manager_test.go:26 +0x8f
  github.com/ChainSafe/gossamer/dot/network.TestStreamManager()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/stream_manager_test.go:69 +0x54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x000005df4ec8 by goroutine 364:
  github.com/ChainSafe/gossamer/dot/network.(*streamManager).start.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/stream_manager.go:39 +0x4a

Goroutine 93 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
==================
WARNING: DATA RACE
Write at 0x00c00f55ccd0 by goroutine 44:
  runtime.closechan()
      /usr/local/go/src/runtime/chan.go:355 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:144 +0x7e
  github.com/ChainSafe/gossamer/dot/network.(*Service).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:456 +0x223
  github.com/ChainSafe/gossamer/dot/network.createTestService.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:110 +0x4a
  testing.(*common).Cleanup.func1()
      /usr/local/go/src/testing/testing.go:912 +0x199
  testing.(*common).runCleanup()
      /usr/local/go/src/testing/testing.go:1049 +0x154
  testing.tRunner.func2()
      /usr/local/go/src/testing/testing.go:1253 +0x4f
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1265 +0x268
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c00f55ccd0 by goroutine 788:
  runtime.chansend()
      /usr/local/go/src/runtime/chan.go:158 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Incoming()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:86 +0xc4
  github.com/ChainSafe/gossamer/dot/network.(*Service).handleConn()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:435 +0xfb
  github.com/ChainSafe/gossamer/dot/network.(*Service).handleConn-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:433 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Swarm).addConn·dwrap·13()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm.go:285 +0x58

Goroutine 44 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
=== CONT  TestBootstrap
    testing.go:1152: race detected during execution of test
--- FAIL: TestBootstrap (1.68s)
=== CONT  TestStreamCloseMetadataCleanup
2021-12-07T14:25:57-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseMetadataCleanup3488773186/001/TestStreamCloseMetadataCleanup/nodeA/node.key	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:57-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60493/p2p/12D3KooWCe9y854cKSwVjeh7hQzW96zXNWpRgArDBbAYKsNeqdXC	pkg=network
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistPeerStore4076152564/002/TestPersistPeerStore/node1/node.key	pkg=network
2021-12-07T14:25:57-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:57-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleConn2162876927/002/TestHandleConn/nodeB/node.key	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60494/p2p/12D3KooWEc3w2G3N3xsAsWeBa9zteEsUK9exDijPeno2H6uWSdN1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60495/p2p/12D3KooWCiS8okWhdyMFMn9TkG3s3bYMgW6SN6rZqfrdCgLNbY5U	pkg=network
2021-12-07T14:25:58-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStreamCloseMetadataCleanup3488773186/002/TestStreamCloseMetadataCleanup/nodeB/node.key	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60496/p2p/12D3KooWJMaMZBNKx22kTN1ojkYio6PM4LHzgRZYKwd5YAPz6dHf	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c026638930 by goroutine 46:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:262 +0xcbc
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c026638930 by goroutine 649:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 649 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c015619108 by goroutine 46:
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:262 +0xcc9
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c015619108 by goroutine 649:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 649 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c04597cf90 by goroutine 45:
  runtime.mapaccess2_faststr()
      /usr/local/go/src/runtime/map_faststr.go:107 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:209 +0xa3c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c04597cf90 by goroutine 513:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c0008bd528 by goroutine 45:
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:209 +0xa4d
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0008bd528 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c0002c1990 by goroutine 45:
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xae4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0002c1990 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x17c
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00283ec00 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00283ec00 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:194 +0x77b
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00283ec08 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1425 +0x1d8
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00283ec08 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:195 +0x7c8
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00283ec18 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1419 +0x225
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00283ec18 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:196 +0x835
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c03d8a5fe0 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:90 +0x1684
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c03d8a5fe0 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:182 +0x6fa
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00283ec20 by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00283ec20 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:197 +0x89a
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00283ec28 by goroutine 45:
  reflect.Value.IsNil()
      /usr/local/go/src/reflect/value.go:1419 +0x225
  reflect.deepValueEqual.func1()
      /usr/local/go/src/reflect/deepequal.go:50 +0x11d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:55 +0x16d
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c00283ec28 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:198 +0x8ba
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c00284647c by goroutine 45:
  reflect.typedmemmove()
      /usr/local/go/src/runtime/mbarrier.go:178 +0x0
  reflect.packEface()
      /usr/local/go/src/reflect/value.go:123 +0xae
  reflect.valueInterface()
      /usr/local/go/src/reflect/value.go:1381 +0x18a
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:154 +0x9dc
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:123 +0x142c
  reflect.deepValueEqual()
      /usr/local/go/src/reflect/deepequal.go:120 +0xfe7
  reflect.DeepEqual()
      /usr/local/go/src/reflect/deepequal.go:218 +0x404
  github.com/stretchr/testify/assert.ObjectsAreEqual()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:65 +0x184
  github.com/stretchr/testify/assert.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/assert/assertions.go:343 +0x212
  github.com/stretchr/testify/require.Equal()
      /Users/eclesiojunior/go/pkg/mod/github.com/stretchr/testify@v1.7.0/require/require.go:162 +0xc8
  github.com/ChainSafe/gossamer/dot/network.TestSend()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:212 +0xb54
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c002846478 by goroutine 513:
  github.com/ChainSafe/gossamer/dot/network/proto.(*BlockRequest).Reset()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/proto/api.v1.pb.go:102 +0x37
  google.golang.org/protobuf/proto.Reset()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/reset.go:18 +0x4d
  google.golang.org/protobuf/proto.UnmarshalOptions.unmarshal()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/decode.go:77 +0xcc
  google.golang.org/protobuf/proto.Unmarshal()
      /Users/eclesiojunior/go/pkg/mod/google.golang.org/protobuf@v1.27.1/proto/decode.go:50 +0xa4
  github.com/ChainSafe/gossamer/dot/network.(*BlockRequestMessage).Decode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/message.go:152 +0xf4
  github.com/ChainSafe/gossamer/dot/network.testBlockRequestMessageDecoder()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:211 +0x51
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:177 +0x29e
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 45 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 513 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:25:58-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
2021-12-07T14:25:58-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestSend
    testing.go:1152: race detected during execution of test
=== CONT  TestConnect
--- FAIL: TestSend (2.79s)
2021-12-07T14:25:58-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestConnect660471562/001/TestConnect/nodeA/node.key	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60497/p2p/12D3KooWNFGDV5RxrJUeSYfDG3ZMfgt5rRFHkfXfrGB494FkN15f	pkg=network
2021-12-07T14:25:58-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:58-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:58-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60492/p2p/12D3KooWGeN7T72ianzPN2q4j3u7sPX8ArYwRSEzwqu8G3FfgEf1	pkg=network
=== CONT  TestHandleConn
    testing.go:1152: race detected during execution of test
--- FAIL: TestHandleConn (1.77s)
=== CONT  TestExternalAddrs
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExternalAddrs1664404029/001/TestExternalAddrs/node/node.key	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:59-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60498/p2p/12D3KooWQrDF68TqBYe2RsJq9YWTnz4Dex72ziVAUMbNrLepVjHB	pkg=network
2021-12-07T14:25:59-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestConnect660471562/002/TestConnect/nodeB/node.key	pkg=network
=== CONT  TestStreamManager
    testing.go:1152: race detected during execution of test
--- FAIL: TestStreamManager (1.94s)
=== CONT  TestExternalAddrsPublicIP
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestExternalAddrsPublicIP1289943567/001/TestExternalAddrsPublicIP/node/node.key	pkg=network
2021-12-07T14:25:59-04:00 DBUG using config PublicIP: 10.0.5.2	pkg=network
2021-12-07T14:25:59-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c0266e9950 by goroutine 46:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:274 +0x1008
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0266e9950 by goroutine 110:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 110 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c015619528 by goroutine 46:
  github.com/ChainSafe/gossamer/dot/network.TestExistingStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:274 +0x1015
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c015619528 by goroutine 110:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 46 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 110 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:25:59-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
2021-12-07T14:25:59-04:00 DBUG failed to read from stream using protocol /gossamer/test/0: failed to read length: stream reset	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:59-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60500/p2p/12D3KooWAGy93oXX8yws3hCsc97b44b9biwoPuhonYd4GzTYuPg4	pkg=network
2021-12-07T14:25:59-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:25:59-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:25:59-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60501/p2p/12D3KooWMDGv3j4LeB9LzMuiHY9s5PChWFiUYmfLsRSRjcD91kg2	pkg=network
2021-12-07T14:25:59-04:00 INFO Started listening on /ip4/10.0.5.2/tcp/60501/p2p/12D3KooWMDGv3j4LeB9LzMuiHY9s5PChWFiUYmfLsRSRjcD91kg2	pkg=network
=== CONT  TestExternalAddrs
    testing.go:1152: race detected during execution of test
--- FAIL: TestExternalAddrs (0.80s)
=== CONT  TestPersistPeerStore
    testing.go:1152: race detected during execution of test
=== CONT  TestEncodeBlockRequestMessage_BlockHash
--- FAIL: TestPersistPeerStore (2.57s)
=== CONT  TestMessageCacheError
=== CONT  TestExistingStream
    testing.go:1152: race detected during execution of test
--- FAIL: TestExistingStream (3.99s)
=== CONT  TestEncodeBlockRequestMessage
=== CONT  TestGossip
--- PASS: TestEncodeBlockRequestMessage_BlockHash (0.00s)
=== CONT  TestKadDHT
--- PASS: TestEncodeBlockRequestMessage (0.00s)
=== CONT  TestEncodeBlockRequestMessage_BlockNumber
--- PASS: TestMessageCacheError (0.01s)
--- PASS: TestEncodeBlockRequestMessage_BlockNumber (0.00s)
=== CONT  TestBeginDiscovery
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT3541199343/001/TestKadDHT/node0/node.key	pkg=network
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip1543723579/001/TestGossip/nodeA/node.key	pkg=network
2021-12-07T14:25:59-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery892423823/001/TestBeginDiscovery/nodeA/node.key	pkg=network
2021-12-07T14:25:59-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWCe9y854cKSwVjeh7hQzW96zXNWpRgArDBbAYKsNeqdXC	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60503/p2p/12D3KooWAMjrqHWAwXEWL1WrvUJj3Sr6rhL9Yyk4brS2vq2CrFuF	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60502/p2p/12D3KooWKAq2UuEy36WHJkY3bVQd1gAqooZTuomxbei8HNQHfLFq	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60504/p2p/12D3KooWSqDBsaZDT1uZExaubZ1jZmWLt2qSboQzkprKxAw6AjaK	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestExternalAddrsPublicIP
    testing.go:1152: race detected during execution of test
--- FAIL: TestExternalAddrsPublicIP (0.88s)
=== CONT  TestSetReservedPeer
2021-12-07T14:26:00-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer310528100/001/TestSetReservedPeer/node0/node.key	pkg=network
=== CONT  TestConnect
    testing.go:1152: race detected during execution of test
--- FAIL: TestConnect (1.65s)
=== CONT  TestEncodeLightResponse
=== CONT  TestEncodeLightRequest
--- PASS: TestEncodeLightResponse (0.00s)
=== CONT  TestMessageCache
--- PASS: TestEncodeLightRequest (0.00s)
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60505/p2p/12D3KooWDdtJgA3UXKjNA1t1qbZXfecepKDfyePU23rpKYVojDKo	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT3541199343/002/TestKadDHT/node1/node.key	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip1543723579/002/TestGossip/nodeB/node.key	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery892423823/002/TestBeginDiscovery/nodeB/node.key	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60506/p2p/12D3KooWRuMKNsP4jUfsrCSwcxEBQLExHJjF4VMsduH4V5jNx4E7	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60507/p2p/12D3KooWGLiiXWD7WrbkKyi9PKXqQpHa3jxRnMqW17RFBLJyxGFu	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:00-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60508/p2p/12D3KooWMFo74g4p6fj8g6D2BTHENNiAyMczYDnzf1j1TSprVnex	pkg=network
2021-12-07T14:26:00-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:00-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer310528100/002/TestSetReservedPeer/node1/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60509/p2p/12D3KooWCkzQyEZSuDUpT4HynZ1cjeM6dK69PwtfFQwusHwLnES7	pkg=network
=== CONT  TestStreamCloseMetadataCleanup
    testing.go:1152: race detected during execution of test
=== CONT  TestDecodeLightMessage
--- FAIL: TestStreamCloseMetadataCleanup (3.50s)
--- PASS: TestDecodeLightMessage (0.01s)
=== CONT  TestMDNS
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMDNS3428643133/001/TestMDNS/nodeA/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestKadDHT3541199343/003/TestKadDHT/node2/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c03e972070 by goroutine 51:
  github.com/ChainSafe/gossamer/dot/network.TestStreamCloseEOF()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:555 +0xa5e
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c03e972070 by goroutine 197:
  [failed to restore the stack]

Goroutine 51 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264
==================
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60511/p2p/12D3KooWQSzu4g54pa5mSTX2ixJLrhFBhh7Si8e1vzRWCqcBRECB	pkg=network
2021-12-07T14:26:01-04:00 DBUG starting DHT with bootnodes [{12D3KooWMFo74g4p6fj8g6D2BTHENNiAyMczYDnzf1j1TSprVnex: [/ip4/127.0.0.1/tcp/60508]}]...	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60512/p2p/12D3KooWPWuNizWj3b9VuvYEzvLLtgvBBkhtg6Q6bThgVRptCZv1	pkg=network
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestGossip1543723579/003/TestGossip/nodeC/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer310528100/003/TestSetReservedPeer/node2/node.key	pkg=network
=== CONT  TestStreamCloseEOF
    testing.go:1152: race detected during execution of test
--- FAIL: TestStreamCloseEOF (6.96s)
=== CONT  TestBannedPeer
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBannedPeer1156012698/001/TestBannedPeer/nodeA/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60515/p2p/12D3KooWAwjbbmsNZMK5TkffPh7xr4CxsiptJFjbG46uCgYGPjJZ	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60516/p2p/12D3KooWN28uGhnj2ApkVJQcoWb68ngoBYC3yzwWCP1a2aXaakcj	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:01-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60517/p2p/12D3KooWQ4HzD8T6339TyaXD4Chns1EHTpHeVJVvgyUc38qYXtqi	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:01-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMDNS3428643133/002/TestMDNS/nodeB/node.key	pkg=network
2021-12-07T14:26:01-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60518/p2p/12D3KooWKsaxAVeftv34StbMT2VrRtowc2Repw5mkWoKf8rJ2sRs	pkg=network
2021-12-07T14:26:02-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestSetReservedPeer310528100/004/TestSetReservedPeer/node3/node.key	pkg=network
2021-12-07T14:26:02-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
=== CONT  TestGossip
    gossip_test.go:93: 
        	Error Trace:	gossip_test.go:93
        	Error:      	Received unexpected error:
        	            	protocol not supported
        	Test:       	TestGossip
2021-12-07T14:26:02-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBannedPeer1156012698/002/TestBannedPeer/nodeB/node.key	pkg=network
2021-12-07T14:26:02-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:02-04:00 DBUG starting DHT with bootnodes [{12D3KooWSqDBsaZDT1uZExaubZ1jZmWLt2qSboQzkprKxAw6AjaK: [/ip4/127.0.0.1/tcp/60504]}]...	pkg=network
2021-12-07T14:26:02-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:26:02-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
2021-12-07T14:26:02-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60520/p2p/12D3KooWGtmDUHhUbZHS3Ep3CGbHVCuS1QP5PcvWPeeT2EwfetAZ	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60521/p2p/12D3KooWJPsv2Tyha3gGiLxrmZbw9jdFWQgx9AJWDhv8PHoQ7TPg	pkg=network
2021-12-07T14:26:02-04:00 DBUG connection successful with peer 12D3KooWDdtJgA3UXKjNA1t1qbZXfecepKDfyePU23rpKYVojDKo	pkg=network
    testing.go:1152: race detected during execution of test
--- FAIL: TestGossip (2.92s)
=== CONT  TestHandleLightMessage_Response
2021-12-07T14:26:02-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleLightMessage_Response241592593/001/TestHandleLightMessage_Response/nodeA/node.key	pkg=network
2021-12-07T14:26:02-04:00 DBUG connection successful with peer 12D3KooWCkzQyEZSuDUpT4HynZ1cjeM6dK69PwtfFQwusHwLnES7	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:02-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:02-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60522/p2p/12D3KooWGLCPGN38ix3PyD178HLCdAMPVXnNgTGiHcWRsZCiyjGM	pkg=network
2021-12-07T14:26:03-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:03-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:03-04:00 DBUG connection successful with peer 12D3KooWJPsv2Tyha3gGiLxrmZbw9jdFWQgx9AJWDhv8PHoQ7TPg	pkg=network
2021-12-07T14:26:03-04:00 CRIT highest rated peer is below bannedThresholdValue	pkg=peerset
2021-12-07T14:26:03-04:00 DBUG connection dropped successfully for peer 12D3KooWJPsv2Tyha3gGiLxrmZbw9jdFWQgx9AJWDhv8PHoQ7TPg	pkg=network
2021-12-07T14:26:03-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:03-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleLightMessage_Response241592593/002/TestHandleLightMessage_Response/nodeB/node.key	pkg=network
2021-12-07T14:26:03-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:03-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:03-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:03-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60523/p2p/12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt	pkg=network
2021-12-07T14:26:03-04:00 WARN failed to open connection for peer 12D3KooWQSzu4g54pa5mSTX2ixJLrhFBhh7Si8e1vzRWCqcBRECB: context canceled	pkg=network
=== CONT  TestBeginDiscovery
    testing.go:1152: race detected during execution of test
--- FAIL: TestBeginDiscovery (3.91s)
=== CONT  TestPeerReputation
2021-12-07T14:26:03-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerReputation1465209743/001/TestPeerReputation/nodeA/node.key	pkg=network
=== CONT  TestMDNS
    testing.go:1152: race detected during execution of test
=== CONT  TestMaxPeers
--- FAIL: TestMDNS (2.53s)
2021-12-07T14:26:03-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/001/TestMaxPeers/node0/node.key	pkg=network
2021-12-07T14:26:03-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:26:03-04:00 DBUG connection successful with peer 12D3KooWN28uGhnj2ApkVJQcoWb68ngoBYC3yzwWCP1a2aXaakcj	pkg=network
=== CONT  TestMessageCache
    testing.go:1152: race detected during execution of test
--- FAIL: TestMessageCache (3.53s)
=== CONT  TestPersistentPeers
2021-12-07T14:26:03-04:00 CRIT highest rated peer is below bannedThresholdValue	pkg=peerset
2021-12-07T14:26:03-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistentPeers1668795105/001/TestPersistentPeers/node-a/node.key	pkg=network
2021-12-07T14:26:03-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:03-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:03-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60524/p2p/12D3KooWBQcVber8K4GQD17SbF5WUoDLVuLWVZesNP4yVUPS2EFg	pkg=network
2021-12-07T14:26:03-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60525/p2p/12D3KooWKJEtUR4soQeXuicPrwA6CuPZxzdTYiBVdE2gunypp8nw	pkg=network
2021-12-07T14:26:04-04:00 WARN ignoring LightRequest without request data	pkg=network
2021-12-07T14:26:04-04:00 DBUG cleaning up inbound handshake data for protocol=/gossamer/test/0/light/2, peer=12D3KooWGLCPGN38ix3PyD178HLCdAMPVXnNgTGiHcWRsZCiyjGM	pkg=network
2021-12-07T14:26:04-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:26:04-04:00 WARN failed to send LightResponse message to peer 12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt: stream closed	pkg=network
2021-12-07T14:26:04-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:26:04-04:00 WARN failed to send LightResponse message to peer 12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt: stream closed	pkg=network
2021-12-07T14:26:04-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:26:04-04:00 WARN failed to send LightResponse message to peer 12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt: stream closed	pkg=network
2021-12-07T14:26:04-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:26:04-04:00 WARN failed to send LightResponse message to peer 12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt: stream closed	pkg=network
2021-12-07T14:26:04-04:00 DBUG LightResponse message: RemoteCallResponse=Proof = RemoteReadResponse=Proof = RemoteHeaderResponse=Header =[] Proof = RemoteChangesResponse=Max = Proof =[] Roots=[] RootsProof=	pkg=network
2021-12-07T14:26:04-04:00 WARN failed to send LightResponse message to peer 12D3KooWRdnXYdxCFBqiHFYbWqbSh2gVKVEtcRY8TTSAj5ydQyZt: stream closed	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60526/p2p/12D3KooWSfsC3Qnfqukg19bRJ3NnEef3PDsFuhEjNuPkPvwQTMyR	pkg=network
=== CONT  TestProtectUnprotectPeer
--- PASS: TestHandleLightMessage_Response (1.66s)
=== CONT  TestMinPeers
--- PASS: TestProtectUnprotectPeer (0.00s)
=== CONT  TestSetReservedPeer
    testing.go:1152: race detected during execution of test
--- FAIL: TestSetReservedPeer (4.09s)
=== CONT  TestBuildIdentity
=== CONT  Test_sizedBufferPool_race
--- PASS: TestBuildIdentity (0.01s)
=== CONT  TestService_NodeRoles
--- PASS: Test_sizedBufferPool_race (0.00s)
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers102499482/001/TestMinPeers/node0/node.key	pkg=network
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestService_NodeRoles3521792647/001/TestService_NodeRoles/node/node.key	pkg=network
2021-12-07T14:26:04-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
2021-12-07T14:26:04-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPeerReputation1465209743/002/TestPeerReputation/nodeB/node.key	pkg=network
2021-12-07T14:26:04-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/002/TestMaxPeers/node1/node.key	pkg=network
2021-12-07T14:26:04-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60527/p2p/12D3KooWLLE7thnZ3bKqEmjm9zkjFKn5nwgRaYhCyLMZtvkcDxBZ	pkg=network
=== CONT  TestService_NodeRoles
    service_test.go:266: 
        	Error Trace:	service_test.go:102
        	            				service_test.go:266
        	Error:      	Received unexpected error:
        	            	failed to listen on any addresses: [listen tcp4 0.0.0.0:7000: bind: address already in use]
        	Test:       	TestService_NodeRoles
=== CONT  TestBroadcastDuplicateMessage
--- FAIL: TestService_NodeRoles (0.27s)
2021-12-07T14:26:04-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastDuplicateMessage1378793643/001/TestBroadcastDuplicateMessage/nodeA/node.key	pkg=network
2021-12-07T14:26:04-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestPersistentPeers1668795105/002/TestPersistentPeers/node-b/node.key	pkg=network
2021-12-07T14:26:04-04:00 WARN Bootstrap is enabled but no bootstrap nodes are defined	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60528/p2p/12D3KooWSRT3zXUr7LBnBCeXSnLNTeoR5eChzjnD9Ep855CBXiY8	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60529/p2p/12D3KooWMAH8Cxw7cDLDUX5mWatq2Zmu6sv8v9GDxk9wJV38jrFX	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60530/p2p/12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:04-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:04-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60531/p2p/12D3KooWFrMTXo6H5fyVRbgRHRvsrAQotH3DHAwsPKdmwKrcjmNG	pkg=network
2021-12-07T14:26:04-04:00 DBUG connection successful with peer 12D3KooWSfsC3Qnfqukg19bRJ3NnEef3PDsFuhEjNuPkPvwQTMyR	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers102499482/002/TestMinPeers/node1/node.key	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60533/p2p/12D3KooWPcmHB9uVKBEFkmAnxBKEho5DPBkphA66QxZEo4akS1SN	pkg=network
2021-12-07T14:26:05-04:00 DBUG connection successful with peer 12D3KooWSRT3zXUr7LBnBCeXSnLNTeoR5eChzjnD9Ep855CBXiY8	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/003/TestMaxPeers/node2/node.key	pkg=network
2021-12-07T14:26:05-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:26:05-04:00 DBUG cleaning up outbound handshake data for protocol=/gossamer/test/0/block-announces/1, peer=12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA	pkg=network
2021-12-07T14:26:05-04:00 DBUG failed to send handshake to peer 12D3KooWKRyzVWW6ChFjQjK4miCty85Niy49tpPV95XdKu1BcvMA on protocol /gossamer/test/0/block-announces/1: handshake timeout reached	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastDuplicateMessage1378793643/002/TestBroadcastDuplicateMessage/nodeB/node.key	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c0027f1c50 by goroutine 54:
  runtime.mapaccess2_faststr()
      /usr/local/go/src/runtime/map_faststr.go:107 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).getNode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:117 +0x8b
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:109 +0x31
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0027f1c50 by goroutine 846:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:224 +0x24f
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 846 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c0a21d5408 by goroutine 54:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).getNode()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:117 +0x99
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:109 +0x31
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0a21d5408 by goroutine 846:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:224 +0x25e
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 846 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c065792ff0 by goroutine 54:
  github.com/ChainSafe/gossamer/dot/peerset.(*node).getReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:92 +0x10a
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).PeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:113 +0x117
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:704 +0x7bd
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c065792ff0 by goroutine 846:
  github.com/ChainSafe/gossamer/dot/peerset.(*node).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:96 +0x1f0
  github.com/ChainSafe/gossamer/dot/peerset.(*PeersState).addReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerstate.go:223 +0x36
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).reportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:325 +0x154
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).doWork()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:714 +0x529
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start·dwrap·1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x47

Goroutine 54 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 846 (running) created at:
  github.com/ChainSafe/gossamer/dot/peerset.(*PeerSet).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/peerset.go:673 +0x170
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:123 +0x154
  github.com/ChainSafe/gossamer/dot/network.(*Service).startPeerSetHandler()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:656 +0x81
  github.com/ChainSafe/gossamer/dot/network.(*Service).Start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:258 +0xea6
  github.com/ChainSafe/gossamer/dot/network.createTestService()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:106 +0x7a8
  github.com/ChainSafe/gossamer/dot/network.TestPeerReputation()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host_test.go:671 +0x1e4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60534/p2p/12D3KooWCjpj5fDQxbmyK1ermEon9L4Bnd6PtpTPrVKm8SfSaw7h	pkg=network
=== CONT  TestPeerReputation
    testing.go:1152: race detected during execution of test
--- FAIL: TestPeerReputation (1.94s)
=== CONT  TestStartService
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60535/p2p/12D3KooWStzVmgNeF3GUy1WStsfTbNZ2YZ4qFvSnH66K1hmYGCnb	pkg=network
2021-12-07T14:26:05-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestStartService3976781647/001/TestStartService/node/node.key	pkg=network
2021-12-07T14:26:05-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMinPeers102499482/003/TestMinPeers/nodeB/node.key	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60536/p2p/12D3KooWMhP2FA9j9meaVBoCv4zKrbK5hWBQXotmRknccuBJWnyJ	pkg=network
2021-12-07T14:26:05-04:00 DBUG connection successful with peer 12D3KooWJPsv2Tyha3gGiLxrmZbw9jdFWQgx9AJWDhv8PHoQ7TPg	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:05-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:05-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60537/p2p/12D3KooWG6dKYvHvtM6uwnAsTgZ3LG26gnzZJRd49siBPp7YC9vL	pkg=network
2021-12-07T14:26:05-04:00 DBUG bootstrapping to peer 12D3KooWLLE7thnZ3bKqEmjm9zkjFKn5nwgRaYhCyLMZtvkcDxBZ	pkg=network
2021-12-07T14:26:05-04:00 DBUG bootstrapping to peer 12D3KooWPcmHB9uVKBEFkmAnxBKEho5DPBkphA66QxZEo4akS1SN	pkg=network
2021-12-07T14:26:05-04:00 DBUG connection successful with peer 12D3KooWLLE7thnZ3bKqEmjm9zkjFKn5nwgRaYhCyLMZtvkcDxBZ	pkg=network
2021-12-07T14:26:05-04:00 DBUG connection successful with peer 12D3KooWPcmHB9uVKBEFkmAnxBKEho5DPBkphA66QxZEo4akS1SN	pkg=network
2021-12-07T14:26:06-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/004/TestMaxPeers/node3/node.key	pkg=network
2021-12-07T14:26:06-04:00 WARN min peers higher than max peers; setting to default	pkg=network
2021-12-07T14:26:06-04:00 DBUG connection dropped successfully for peer 12D3KooWFrMTXo6H5fyVRbgRHRvsrAQotH3DHAwsPKdmwKrcjmNG	pkg=network
=== CONT  TestMaxPeers
    connmgr_test.go:73: 
        	Error Trace:	service_test.go:102
        	            				connmgr_test.go:73
        	Error:      	Received unexpected error:
        	            	open /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/004/TestMaxPeers/node3/libp2p-datastore: too many open files
        	            	While opening directory: /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestMaxPeers1963342565/004/TestMaxPeers/node3/libp2p-datastore.
        	            	github.com/dgraph-io/badger/v2.syncDir
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/dgraph-io/badger/v2@v2.2007.4/dir_unix.go:109
        	            	github.com/dgraph-io/badger/v2.helpRewrite
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/dgraph-io/badger/v2@v2.2007.4/manifest.go:294
        	            	github.com/dgraph-io/badger/v2.helpOpenOrCreateManifestFile
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/dgraph-io/badger/v2@v2.2007.4/manifest.go:147
        	            	github.com/dgraph-io/badger/v2.openOrCreateManifestFile
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/dgraph-io/badger/v2@v2.2007.4/manifest.go:127
        	            	github.com/dgraph-io/badger/v2.Open
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/dgraph-io/badger/v2@v2.2007.4/db.go:283
        	            	github.com/ipfs/go-ds-badger2.NewDatastore
        	            		/Users/eclesiojunior/go/pkg/mod/github.com/ipfs/go-ds-badger2@v0.1.1/datastore.go:150
        	            	github.com/ChainSafe/gossamer/dot/network.newHost
        	            		/Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/host.go:132
        	            	github.com/ChainSafe/gossamer/dot/network.NewService
        	            		/Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:130
        	            	github.com/ChainSafe/gossamer/dot/network.createTestService
        	            		/Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:101
        	            	github.com/ChainSafe/gossamer/dot/network.TestMaxPeers
        	            		/Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/connmgr_test.go:73
        	            	testing.tRunner
        	            		/usr/local/go/src/testing/testing.go:1259
        	            	runtime.goexit
        	            		/usr/local/go/src/runtime/asm_amd64.s:1581
        	Test:       	TestMaxPeers
2021-12-07T14:26:06-04:00 DBUG connection successful with peer 12D3KooWFrMTXo6H5fyVRbgRHRvsrAQotH3DHAwsPKdmwKrcjmNG	pkg=network
2021-12-07T14:26:06-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
    testing.go:1152: race detected during execution of test
--- FAIL: TestMaxPeers (2.59s)
=== CONT  TestHandleBlockAnnounceMessage
2021-12-07T14:26:06-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestHandleBlockAnnounceMessage2619289495/001/TestHandleBlockAnnounceMessage/nodeA/node.key	pkg=network
2021-12-07T14:26:06-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 DBUG connection dropped successfully for peer 12D3KooWLLE7thnZ3bKqEmjm9zkjFKn5nwgRaYhCyLMZtvkcDxBZ	pkg=network
--- PASS: TestStartService (0.79s)
=== CONT  TestDecodeBlockAnnounceHandshake
=== CONT  TestBroadcastMessages
--- PASS: TestDecodeBlockAnnounceHandshake (0.00s)
==================
WARNING: DATA RACE
Write at 0x00c0657f4258 by goroutine 87:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:248 +0xe8b
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c0657f4258 by goroutine 664:
  github.com/ChainSafe/gossamer/dot/network.(*Service).sendData()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:285 +0x3b2
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding·dwrap·10()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0xb4

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 664 (finished) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0x467
  github.com/ChainSafe/gossamer/dot/network.(*Service).GossipMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:530 +0x3d9
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:241 +0xd56
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastMessages529829691/001/TestBroadcastMessages/nodeA/node.key	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:06-04:00 DBUG gossiping from host 12D3KooWEonVtquoWcsj4cansGKjRHepxtuc8r4P944tyE9Vvr6r message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c021dadf20 by goroutine 87:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:255 +0xf78
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c021dadf20 by goroutine 254:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 254 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c02a16b108 by goroutine 87:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:255 +0xf85
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c02a16b108 by goroutine 254:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 254 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:26:06-04:00 DBUG failed to read from stream using protocol /gossamer/test/0/block-announces/1: failed to read length: stream reset	pkg=network
2021-12-07T14:26:06-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:06-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60539/p2p/12D3KooWDpjvuBferNGgUZNyevbfWvDgkwtAecw9k4LqzLwwvbkG	pkg=network
=== CONT  TestBannedPeer
    testing.go:1152: race detected during execution of test
=== CONT  Test_HandshakeTimeout
    testing.go:1152: race detected during execution of test
=== CONT  Test_sizedBufferPool
--- FAIL: TestBannedPeer (5.20s)
=== CONT  TestEncodeBlockAnnounceHandshake
=== CONT  TestBuild
--- PASS: Test_sizedBufferPool (0.00s)
--- FAIL: Test_HandshakeTimeout (13.52s)
=== CONT  TestBlockAnnounceHandshakeSize
--- PASS: TestEncodeBlockAnnounceHandshake (0.00s)
=== CONT  TestDecodeBlockAnnounce
--- PASS: TestBlockAnnounceHandshakeSize (0.00s)
=== CONT  TestValidateBlockAnnounceHandshake
--- PASS: TestDecodeBlockAnnounce (0.00s)
=== CONT  TestEncodeBlockAnnounceMessage
--- PASS: TestBuild (0.05s)
--- PASS: TestEncodeBlockAnnounceMessage (0.00s)
=== CONT  TestEncodeTransactionMessageSingleExtrinsic
=== CONT  TestEncodeBlockResponseMessage_WithAll
--- PASS: TestEncodeTransactionMessageSingleExtrinsic (0.00s)
=== CONT  TestEncodeBlockResponseMessage_Empty
--- PASS: TestEncodeBlockResponseMessage_WithAll (0.01s)
--- PASS: TestEncodeBlockResponseMessage_Empty (0.00s)
=== CONT  TestEncodeBlockResponseMessage_WithBody
--- PASS: TestEncodeBlockResponseMessage_WithBody (0.00s)
=== CONT  TestEncodeBlockRequestMessage_NoOptionals
=== CONT  TestBeginDiscovery_ThreeNodes
--- PASS: TestEncodeBlockRequestMessage_NoOptionals (0.00s)
2021-12-07T14:26:06-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestValidateBlockAnnounceHandshake2935554881/001/TestValidateBlockAnnounceHandshake/nodeA/node.key	pkg=network
2021-12-07T14:26:06-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:06-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:06-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60540/p2p/12D3KooWNqugDjzAoN2zsAcKanwnwLpKsBQ1ykNmXt2kYyX9b1mq	pkg=network
2021-12-07T14:26:06-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes593551894/001/TestBeginDiscovery_ThreeNodes/nodeA/node.key	pkg=network
==================
WARNING: DATA RACE
Write at 0x00c056495810 by goroutine 87:
  runtime.closechan()
      /usr/local/go/src/runtime/chan.go:355 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:144 +0x7e
  github.com/ChainSafe/gossamer/dot/network.(*Service).Stop()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:456 +0x223
  github.com/ChainSafe/gossamer/dot/network.createTestService.func1()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:110 +0x4a
  testing.(*common).Cleanup.func1()
      /usr/local/go/src/testing/testing.go:912 +0x199
  testing.(*common).runCleanup()
      /usr/local/go/src/testing/testing.go:1049 +0x154
  testing.tRunner.func2()
      /usr/local/go/src/testing/testing.go:1253 +0x4f
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1265 +0x268
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous read at 0x00c056495810 by goroutine 1216:
  runtime.chansend()
      /usr/local/go/src/runtime/chan.go:158 +0x0
  github.com/ChainSafe/gossamer/dot/peerset.(*Handler).ReportPeer()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/peerset/handler.go:77 +0xf0
  github.com/ChainSafe/gossamer/dot/network.(*Service).sendData()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:315 +0x957
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding·dwrap·10()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0xb4

Goroutine 87 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 1216 (finished) created at:
  github.com/ChainSafe/gossamer/dot/network.(*Service).broadcastExcluding()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/notifications.go:419 +0x467
  github.com/ChainSafe/gossamer/dot/network.(*Service).GossipMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service.go:530 +0x3d9
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastDuplicateMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:252 +0xeda
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
=== CONT  TestPersistentPeers
    testing.go:1152: race detected during execution of test
--- FAIL: TestPersistentPeers (3.24s)
=== CONT  TestRemovePeer
=== CONT  TestBroadcastDuplicateMessage
    testing.go:1152: race detected during execution of test
=== CONT  TestSerivceIsMajorSyncMetrics
--- FAIL: TestBroadcastDuplicateMessage (2.45s)
=== CONT  TestMinPeers
    testing.go:1152: race detected during execution of test
--- FAIL: TestMinPeers (2.74s)
--- PASS: TestSerivceIsMajorSyncMetrics (0.00s)
2021-12-07T14:26:07-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestRemovePeer572055684/001/TestRemovePeer/nodeA/node.key	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60541/p2p/12D3KooWJfjCmpnZHwuaxbfyBr2Bk7WKQa3wpFudrFM3j4BPgz5p	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60542/p2p/12D3KooWKuR5DnN8k2H62oAAxKobd7j8tBT3rkzGucx9k5vdFuv5	pkg=network
2021-12-07T14:26:07-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60543/p2p/12D3KooWJkAyg5qi1KtDg359mTR3c5Dpz1y6YCGc4AcVm7DKDCWw	pkg=network
=== CONT  TestHandleBlockAnnounceMessage
    testing.go:1152: race detected during execution of test
--- FAIL: TestHandleBlockAnnounceMessage (1.05s)
2021-12-07T14:26:07-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBroadcastMessages529829691/002/TestBroadcastMessages/nodeB/node.key	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60544/p2p/12D3KooWBVWZzSodSJets1LRYBK3wHHtxoQhfTiJdUzzYXpXfmE1	pkg=network
2021-12-07T14:26:07-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes593551894/002/TestBeginDiscovery_ThreeNodes/nodeB/node.key	pkg=network
2021-12-07T14:26:07-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
=== CONT  TestValidateBlockAnnounceHandshake
    testing.go:1152: race detected during execution of test
--- FAIL: TestValidateBlockAnnounceHandshake (0.94s)
2021-12-07T14:26:07-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestRemovePeer572055684/002/TestRemovePeer/nodeB/node.key	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:07-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:07-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60545/p2p/12D3KooWNbJ1gGT5DNugwrNmNWvsUVfrtbyWWW8N4C3yBkY3XcXx	pkg=network
2021-12-07T14:26:08-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:08-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:08-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60546/p2p/12D3KooWSXScNu7Ld3gwL5gMV4zVaZFvgjipokuyKkavQBuEcDFY	pkg=network
2021-12-07T14:26:08-04:00 DBUG bootstrapping to peer 12D3KooWJkAyg5qi1KtDg359mTR3c5Dpz1y6YCGc4AcVm7DKDCWw	pkg=network
2021-12-07T14:26:08-04:00 DBUG connection successful with peer 12D3KooWJkAyg5qi1KtDg359mTR3c5Dpz1y6YCGc4AcVm7DKDCWw	pkg=network
2021-12-07T14:26:08-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:08-04:00 DBUG gossiping from host 12D3KooWNqugDjzAoN2zsAcKanwnwLpKsBQ1ykNmXt2kYyX9b1mq message of type 3: BlockAnnounceMessage ParentHash=0x0000000000000000000000000000000000000000000000000000000000000000 Number=896 StateRoot=0x0000000000000000000000000000000000000000000000000000000000000000 ExtrinsicsRoot=0x0000000000000000000000000000000000000000000000000000000000000000 Digest={{<nil> map[2:{[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} 4:{[0 0 0 0] []} 5:{[0 0 0 0] []} 6:{[0 0 0 0] []}]} []}	pkg=network
2021-12-07T14:26:08-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:08-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:08-04:00 INFO Generating p2p identity with seed 0 and key file /var/folders/vj/qljhg8m12mxfl4bfs4yb_7qh0000gn/T/TestBeginDiscovery_ThreeNodes593551894/003/TestBeginDiscovery_ThreeNodes/nodeC/node.key	pkg=network
2021-12-07T14:26:08-04:00 INFO registered notifications sub-protocol /gossamer/test/0/block-announces/1	pkg=network
2021-12-07T14:26:08-04:00 INFO registered notifications sub-protocol /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:08-04:00 INFO Started listening on /ip4/127.0.0.1/tcp/60548/p2p/12D3KooWPogTnV3D76ntdFNV9emAoSzaXmozBVUVxZBbDS2svwFi	pkg=network
2021-12-07T14:26:09-04:00 DBUG connection dropped successfully for peer 12D3KooWJkAyg5qi1KtDg359mTR3c5Dpz1y6YCGc4AcVm7DKDCWw	pkg=network
2021-12-07T14:26:09-04:00 INFO started network service with supported protocols /p2p/id/delta/1.0.0, /ipfs/id/1.0.0, /ipfs/id/push/1.0.0, /ipfs/ping/1.0.0, /gossamer/test/0/sync/2, /gossamer/test/0/light/2, /gossamer/test/0/block-announces/1, /gossamer/test/0/transactions/1	pkg=network
2021-12-07T14:26:09-04:00 DBUG starting DHT with bootnodes [{12D3KooWNbJ1gGT5DNugwrNmNWvsUVfrtbyWWW8N4C3yBkY3XcXx: [/ip4/127.0.0.1/tcp/60545]} {12D3KooWPogTnV3D76ntdFNV9emAoSzaXmozBVUVxZBbDS2svwFi: [/ip4/127.0.0.1/tcp/60548]}]...	pkg=network
--- PASS: TestRemovePeer (2.35s)
==================
WARNING: DATA RACE
Read at 0x00c0264be7e0 by goroutine 86:
  runtime.mapaccess1_faststr()
      /usr/local/go/src/runtime/map_faststr.go:12 +0x0
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastMessages()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:181 +0x9a4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c0264be7e0 by goroutine 443:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x1f5
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 86 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 443 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
==================
WARNING: DATA RACE
Read at 0x00c02a16b948 by goroutine 86:
  github.com/ChainSafe/gossamer/dot/network.TestBroadcastMessages()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:181 +0x9b1
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c02a16b948 by goroutine 443:
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:137 +0x204
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleMessage-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:135 +0x6d
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).readStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:184 +0x3bc
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:132 +0xab
  github.com/ChainSafe/gossamer/dot/network.(*testStreamHandler).handleStream-fm()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/helpers_test.go:124 +0x4d
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).SetStreamHandler.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:529 +0x86
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler·dwrap·3()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x74

Goroutine 86 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 443 (running) created at:
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:372 +0x7ca
  github.com/libp2p/go-libp2p/p2p/host/basic.(*BasicHost).newStreamHandler-fm()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p@v0.15.1/p2p/host/basic/basic_host.go:329 +0x4d
  github.com/libp2p/go-libp2p-swarm.(*Conn).start.func1.1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-swarm@v0.5.3/swarm_conn.go:125 +0xe4
==================
2021-12-07T14:26:10-04:00 DBUG failed to read from stream using protocol /gossamer/test/0/block-announces/1: failed to read length: stream reset	pkg=network
2021-12-07T14:26:10-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:10-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:26:10-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
2021-12-07T14:26:10-04:00 DBUG starting DHT with bootnodes [{12D3KooWKuR5DnN8k2H62oAAxKobd7j8tBT3rkzGucx9k5vdFuv5: [/ip4/127.0.0.1/tcp/60542]}]...	pkg=network
=== CONT  TestBroadcastMessages
    testing.go:1152: race detected during execution of test
--- FAIL: TestBroadcastMessages (3.87s)
2021-12-07T14:26:10-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:26:10-04:00 DBUG starting DHT with bootnodes [{12D3KooWPWuNizWj3b9VuvYEzvLLtgvBBkhtg6Q6bThgVRptCZv1: [/ip4/127.0.0.1/tcp/60512]}]...	pkg=network
2021-12-07T14:26:11-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:11-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:26:11-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:26:11-04:00 DBUG starting DHT with bootnodes [{12D3KooWKuR5DnN8k2H62oAAxKobd7j8tBT3rkzGucx9k5vdFuv5: [/ip4/127.0.0.1/tcp/60542]}]...	pkg=network
2021-12-07T14:26:11-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:11-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:26:11-04:00 WARN failed to advertise in the DHT: failed to find any peer in table	pkg=network
2021-12-07T14:26:11-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:26:11-04:00 DBUG starting DHT with bootnodes [{12D3KooWAMjrqHWAwXEWL1WrvUJj3Sr6rhL9Yyk4brS2vq2CrFuF: [/ip4/127.0.0.1/tcp/60503]}]...	pkg=network
==================
WARNING: DATA RACE
Read at 0x00c02331ee90 by goroutine 37:
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x264
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Previous write at 0x00c02331ee90 by goroutine 1067:
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:108 +0x6b2
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 37 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1306 +0x726
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:1598 +0x99
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.runTests()
      /usr/local/go/src/testing/testing.go:1596 +0x7ca
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:1504 +0x9d1
  github.com/ChainSafe/gossamer/dot/network.TestMain()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/service_test.go:118 +0x33
  main.main()
      _testmain.go:205 +0x264

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c063d2bc70 by goroutine 460:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x111

Previous write at 0x00c063d2bc70 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:139 +0x93d
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c05f038000 by goroutine 460:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindLocal()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:714 +0x5d
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:625 +0x1b1
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c05f038000 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c05f038058 by goroutine 460:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x126
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c05f038058 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c05f038930 by goroutine 460:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x146
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c05f038930 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059fa4318 by goroutine 460:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:388 +0x70
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c059fa4318 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059fa4360 by goroutine 460:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:394 +0xde
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c059fa4360 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059fa4378 by goroutine 460:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:399 +0x148
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c059fa4378 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059f94e98 by goroutine 460:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2ab
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c059f94e98 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1c4
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059f94e90 by goroutine 460:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2cb
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c059f94e90 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.newBucket()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/bucket.go:45 +0x12a
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1ad
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c05f02afe8 by goroutine 460:
  container/list.(*List).Front()
      /usr/local/go/src/container/list/list.go:70 +0x57
  github.com/libp2p/go-libp2p-kbucket.(*peerDistanceSorter).appendPeersFromList()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/sorting.go:40 +0x69
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:404 +0x2e4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func1()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:241 +0x13b

Previous write at 0x00c05f02afe8 by goroutine 1067:
  container/list.(*List).Init()
      /usr/local/go/src/container/list/list.go:57 +0x113
  container/list.New()
      /usr/local/go/src/container/list/list.go:62 +0x96
  github.com/libp2p/go-libp2p-kbucket.newBucket()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/bucket.go:45 +0x121
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:66 +0x1ad
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:124 +0x73c
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 460 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:239 +0x417
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c063d2bc78 by goroutine 1250:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x115

Previous write at 0x00c063d2bc78 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:139 +0x93d
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 1250 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c054d9aa80 by goroutine 1250:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindLocal()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:714 +0x5d
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:625 +0x1b1
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c054d9aa80 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:278 +0x4d7
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 1250 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c054d9aad8 by goroutine 1250:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x126
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c054d9aad8 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 1250 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c054d9b3b0 by goroutine 1250:
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x146
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c054d9b3b0 by goroutine 1067:
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:273 +0x339
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 1250 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c059e8dd58 by goroutine 1250:
  github.com/libp2p/go-libp2p-kbucket.(*RoutingTable).NearestPeers()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:388 +0x70
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runQuery()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:151 +0x172
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).runLookupWithFollowup()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/query.go:81 +0xc4
  github.com/libp2p/go-libp2p-kad-dht.(*IpfsDHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/routing.go:629 +0x3d9
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer.func2()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:245 +0x144

Previous write at 0x00c059e8dd58 by goroutine 1067:
  github.com/libp2p/go-libp2p-kbucket.NewRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kbucket@v0.4.7/table.go:65 +0x176
  github.com/libp2p/go-libp2p-kad-dht.makeRoutingTable()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:386 +0x2c5
  github.com/libp2p/go-libp2p-kad-dht.makeDHT()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:313 +0xadd
  github.com/libp2p/go-libp2p-kad-dht.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dht.go:180 +0x2b7
  github.com/libp2p/go-libp2p-kad-dht/dual.New()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:134 +0x911
  github.com/ChainSafe/gossamer/dot/network.(*discovery).start()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery.go:103 +0x688
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery·dwrap·26()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x39

Goroutine 1250 (running) created at:
  github.com/libp2p/go-libp2p-kad-dht/dual.(*DHT).FindPeer()
      /Users/eclesiojunior/go/pkg/mod/github.com/libp2p/go-libp2p-kad-dht@v0.11.1/dual/dual.go:243 +0x617
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:91 +0x292
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47

Goroutine 1067 (running) created at:
  github.com/ChainSafe/gossamer/dot/network.newTestDiscovery()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:45 +0x4d7
  github.com/ChainSafe/gossamer/dot/network.TestKadDHT()
      /Users/eclesiojunior/go/src/github.com/ChainSafe/gossamer/dot/network/discovery_test.go:80 +0xe4
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
2021-12-07T14:26:12-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:12-04:00 DBUG advertising ourselves in the DHT...	pkg=network
2021-12-07T14:26:12-04:00 DBUG DHT discovery started!	pkg=network
2021-12-07T14:26:12-04:00 DBUG advertising ourselves in the DHT...	pkg=network
=== CONT  TestBeginDiscovery_ThreeNodes
    testing.go:1152: race detected during execution of test
--- FAIL: TestBeginDiscovery_ThreeNodes (6.07s)
2021-12-07T14:26:21-04:00 DBUG no peers yet, waiting to start DHT...	pkg=network
2021-12-07T14:26:21-04:00 DBUG starting DHT with bootnodes [{12D3KooWAMjrqHWAwXEWL1WrvUJj3Sr6rhL9Yyk4brS2vq2CrFuF: [/ip4/127.0.0.1/tcp/60503]}]...	pkg=network
2021-12-07T14:26:22-04:00 DBUG DHT discovery started!	pkg=network
=== CONT  TestKadDHT
    testing.go:1152: race detected during execution of test
--- FAIL: TestKadDHT (22.49s)
FAIL
FAIL	github.com/ChainSafe/gossamer/dot/network	31.050s
FAIL
